{"version":3,"file":"main.js","mappings":"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","sources":["webpack://pritunl/./node_modules/bufferutil/fallback.js","webpack://pritunl/./node_modules/bufferutil/index.js","webpack://pritunl/./node_modules/node-gyp-build/index.js","webpack://pritunl/./node_modules/utf-8-validate/fallback.js","webpack://pritunl/./node_modules/utf-8-validate/index.js","webpack://pritunl/./node_modules/ws/lib/buffer-util.js","webpack://pritunl/./node_modules/ws/lib/constants.js","webpack://pritunl/./node_modules/ws/lib/event-target.js","webpack://pritunl/./node_modules/ws/lib/extension.js","webpack://pritunl/./node_modules/ws/lib/limiter.js","webpack://pritunl/./node_modules/ws/lib/permessage-deflate.js","webpack://pritunl/./node_modules/ws/lib/receiver.js","webpack://pritunl/./node_modules/ws/lib/sender.js","webpack://pritunl/./node_modules/ws/lib/stream.js","webpack://pritunl/./node_modules/ws/lib/subprotocol.js","webpack://pritunl/./node_modules/ws/lib/validation.js","webpack://pritunl/./node_modules/ws/lib/websocket-server.js","webpack://pritunl/./node_modules/ws/lib/websocket.js","webpack://pritunl/external node-commonjs \"crypto\"","webpack://pritunl/external node-commonjs \"events\"","webpack://pritunl/external node-commonjs \"fs\"","webpack://pritunl/external node-commonjs \"http\"","webpack://pritunl/external node-commonjs \"https\"","webpack://pritunl/external node-commonjs \"net\"","webpack://pritunl/external node-commonjs \"os\"","webpack://pritunl/external node-commonjs \"path\"","webpack://pritunl/external node-commonjs \"stream\"","webpack://pritunl/external node-commonjs \"tls\"","webpack://pritunl/external node-commonjs \"url\"","webpack://pritunl/external node-commonjs \"zlib\"","webpack://pritunl/webpack/bootstrap","webpack://pritunl/webpack/runtime/compat get default export","webpack://pritunl/webpack/runtime/define property getters","webpack://pritunl/webpack/runtime/hasOwnProperty shorthand","webpack://pritunl/external node-commonjs \"process\"","webpack://pritunl/external node-commonjs \"electron\"","webpack://pritunl/external node-commonjs \"child_process\"","webpack://pritunl/./main/Utils.ts","webpack://pritunl/./node_modules/ws/wrapper.mjs","webpack://pritunl/./main/Errors.ts","webpack://pritunl/./main/Logger.ts","webpack://pritunl/./main/Request.ts","webpack://pritunl/./main/Service.ts","webpack://pritunl/./main/Config.ts","webpack://pritunl/./main/Main.tsx"],"sourcesContent":["'use strict';\n\n/**\n * Masks a buffer using the given mask.\n *\n * @param {Buffer} source The buffer to mask\n * @param {Buffer} mask The mask to use\n * @param {Buffer} output The buffer where to store the result\n * @param {Number} offset The offset at which to start writing\n * @param {Number} length The number of bytes to mask.\n * @public\n */\nconst mask = (source, mask, output, offset, length) => {\n  for (var i = 0; i < length; i++) {\n    output[offset + i] = source[i] ^ mask[i & 3];\n  }\n};\n\n/**\n * Unmasks a buffer using the given mask.\n *\n * @param {Buffer} buffer The buffer to unmask\n * @param {Buffer} mask The mask to use\n * @public\n */\nconst unmask = (buffer, mask) => {\n  // Required until https://github.com/nodejs/node/issues/9006 is resolved.\n  const length = buffer.length;\n  for (var i = 0; i < length; i++) {\n    buffer[i] ^= mask[i & 3];\n  }\n};\n\nmodule.exports = { mask, unmask };\n","'use strict';\n\ntry {\n  module.exports = require('node-gyp-build')(__dirname);\n} catch (e) {\n  module.exports = require('./fallback');\n}\n","var fs = require('fs')\nvar path = require('path')\nvar os = require('os')\n\n// Workaround to fix webpack's build warnings: 'the request of a dependency is an expression'\nvar runtimeRequire = typeof __webpack_require__ === 'function' ? __non_webpack_require__ : require // eslint-disable-line\n\nvar vars = (process.config && process.config.variables) || {}\nvar prebuildsOnly = !!process.env.PREBUILDS_ONLY\nvar abi = process.versions.modules // TODO: support old node where this is undef\nvar runtime = isElectron() ? 'electron' : 'node'\nvar arch = os.arch()\nvar platform = os.platform()\nvar libc = process.env.LIBC || (isAlpine(platform) ? 'musl' : 'glibc')\nvar armv = process.env.ARM_VERSION || (arch === 'arm64' ? '8' : vars.arm_version) || ''\nvar uv = (process.versions.uv || '').split('.')[0]\n\nmodule.exports = load\n\nfunction load (dir) {\n  return runtimeRequire(load.path(dir))\n}\n\nload.path = function (dir) {\n  dir = path.resolve(dir || '.')\n\n  try {\n    var name = runtimeRequire(path.join(dir, 'package.json')).name.toUpperCase().replace(/-/g, '_')\n    if (process.env[name + '_PREBUILD']) dir = process.env[name + '_PREBUILD']\n  } catch (err) {}\n\n  if (!prebuildsOnly) {\n    var release = getFirst(path.join(dir, 'build/Release'), matchBuild)\n    if (release) return release\n\n    var debug = getFirst(path.join(dir, 'build/Debug'), matchBuild)\n    if (debug) return debug\n  }\n\n  var prebuild = resolve(dir)\n  if (prebuild) return prebuild\n\n  var nearby = resolve(path.dirname(process.execPath))\n  if (nearby) return nearby\n\n  var target = [\n    'platform=' + platform,\n    'arch=' + arch,\n    'runtime=' + runtime,\n    'abi=' + abi,\n    'uv=' + uv,\n    armv ? 'armv=' + armv : '',\n    'libc=' + libc,\n    'node=' + process.versions.node,\n    process.versions.electron ? 'electron=' + process.versions.electron : '',\n    typeof __webpack_require__ === 'function' ? 'webpack=true' : '' // eslint-disable-line\n  ].filter(Boolean).join(' ')\n\n  throw new Error('No native build was found for ' + target + '\\n    loaded from: ' + dir + '\\n')\n\n  function resolve (dir) {\n    // Find matching \"prebuilds/<platform>-<arch>\" directory\n    var tuples = readdirSync(path.join(dir, 'prebuilds')).map(parseTuple)\n    var tuple = tuples.filter(matchTuple(platform, arch)).sort(compareTuples)[0]\n    if (!tuple) return\n\n    // Find most specific flavor first\n    var prebuilds = path.join(dir, 'prebuilds', tuple.name)\n    var parsed = readdirSync(prebuilds).map(parseTags)\n    var candidates = parsed.filter(matchTags(runtime, abi))\n    var winner = candidates.sort(compareTags(runtime))[0]\n    if (winner) return path.join(prebuilds, winner.file)\n  }\n}\n\nfunction readdirSync (dir) {\n  try {\n    return fs.readdirSync(dir)\n  } catch (err) {\n    return []\n  }\n}\n\nfunction getFirst (dir, filter) {\n  var files = readdirSync(dir).filter(filter)\n  return files[0] && path.join(dir, files[0])\n}\n\nfunction matchBuild (name) {\n  return /\\.node$/.test(name)\n}\n\nfunction parseTuple (name) {\n  // Example: darwin-x64+arm64\n  var arr = name.split('-')\n  if (arr.length !== 2) return\n\n  var platform = arr[0]\n  var architectures = arr[1].split('+')\n\n  if (!platform) return\n  if (!architectures.length) return\n  if (!architectures.every(Boolean)) return\n\n  return { name, platform, architectures }\n}\n\nfunction matchTuple (platform, arch) {\n  return function (tuple) {\n    if (tuple == null) return false\n    if (tuple.platform !== platform) return false\n    return tuple.architectures.includes(arch)\n  }\n}\n\nfunction compareTuples (a, b) {\n  // Prefer single-arch prebuilds over multi-arch\n  return a.architectures.length - b.architectures.length\n}\n\nfunction parseTags (file) {\n  var arr = file.split('.')\n  var extension = arr.pop()\n  var tags = { file: file, specificity: 0 }\n\n  if (extension !== 'node') return\n\n  for (var i = 0; i < arr.length; i++) {\n    var tag = arr[i]\n\n    if (tag === 'node' || tag === 'electron' || tag === 'node-webkit') {\n      tags.runtime = tag\n    } else if (tag === 'napi') {\n      tags.napi = true\n    } else if (tag.slice(0, 3) === 'abi') {\n      tags.abi = tag.slice(3)\n    } else if (tag.slice(0, 2) === 'uv') {\n      tags.uv = tag.slice(2)\n    } else if (tag.slice(0, 4) === 'armv') {\n      tags.armv = tag.slice(4)\n    } else if (tag === 'glibc' || tag === 'musl') {\n      tags.libc = tag\n    } else {\n      continue\n    }\n\n    tags.specificity++\n  }\n\n  return tags\n}\n\nfunction matchTags (runtime, abi) {\n  return function (tags) {\n    if (tags == null) return false\n    if (tags.runtime !== runtime && !runtimeAgnostic(tags)) return false\n    if (tags.abi !== abi && !tags.napi) return false\n    if (tags.uv && tags.uv !== uv) return false\n    if (tags.armv && tags.armv !== armv) return false\n    if (tags.libc && tags.libc !== libc) return false\n\n    return true\n  }\n}\n\nfunction runtimeAgnostic (tags) {\n  return tags.runtime === 'node' && tags.napi\n}\n\nfunction compareTags (runtime) {\n  // Precedence: non-agnostic runtime, abi over napi, then by specificity.\n  return function (a, b) {\n    if (a.runtime !== b.runtime) {\n      return a.runtime === runtime ? -1 : 1\n    } else if (a.abi !== b.abi) {\n      return a.abi ? -1 : 1\n    } else if (a.specificity !== b.specificity) {\n      return a.specificity > b.specificity ? -1 : 1\n    } else {\n      return 0\n    }\n  }\n}\n\nfunction isElectron () {\n  if (process.versions && process.versions.electron) return true\n  if (process.env.ELECTRON_RUN_AS_NODE) return true\n  return typeof window !== 'undefined' && window.process && window.process.type === 'renderer'\n}\n\nfunction isAlpine (platform) {\n  return platform === 'linux' && fs.existsSync('/etc/alpine-release')\n}\n\n// Exposed for unit tests\n// TODO: move to lib\nload.parseTags = parseTags\nload.matchTags = matchTags\nload.compareTags = compareTags\nload.parseTuple = parseTuple\nload.matchTuple = matchTuple\nload.compareTuples = compareTuples\n","'use strict';\n\n/**\n * Checks if a given buffer contains only correct UTF-8.\n * Ported from https://www.cl.cam.ac.uk/%7Emgk25/ucs/utf8_check.c by\n * Markus Kuhn.\n *\n * @param {Buffer} buf The buffer to check\n * @return {Boolean} `true` if `buf` contains only correct UTF-8, else `false`\n * @public\n */\nfunction isValidUTF8(buf) {\n  const len = buf.length;\n  let i = 0;\n\n  while (i < len) {\n    if ((buf[i] & 0x80) === 0x00) {  // 0xxxxxxx\n      i++;\n    } else if ((buf[i] & 0xe0) === 0xc0) {  // 110xxxxx 10xxxxxx\n      if (\n        i + 1 === len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i] & 0xfe) === 0xc0  // overlong\n      ) {\n        return false;\n      }\n\n      i += 2;\n    } else if ((buf[i] & 0xf0) === 0xe0) {  // 1110xxxx 10xxxxxx 10xxxxxx\n      if (\n        i + 2 >= len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i + 2] & 0xc0) !== 0x80 ||\n        buf[i] === 0xe0 && (buf[i + 1] & 0xe0) === 0x80 ||  // overlong\n        buf[i] === 0xed && (buf[i + 1] & 0xe0) === 0xa0  // surrogate (U+D800 - U+DFFF)\n      ) {\n        return false;\n      }\n\n      i += 3;\n    } else if ((buf[i] & 0xf8) === 0xf0) {  // 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx\n      if (\n        i + 3 >= len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i + 2] & 0xc0) !== 0x80 ||\n        (buf[i + 3] & 0xc0) !== 0x80 ||\n        buf[i] === 0xf0 && (buf[i + 1] & 0xf0) === 0x80 ||  // overlong\n        buf[i] === 0xf4 && buf[i + 1] > 0x8f || buf[i] > 0xf4  // > U+10FFFF\n      ) {\n        return false;\n      }\n\n      i += 4;\n    } else {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nmodule.exports = isValidUTF8;\n","'use strict';\n\ntry {\n  module.exports = require('node-gyp-build')(__dirname);\n} catch (e) {\n  module.exports = require('./fallback');\n}\n","'use strict';\n\nconst { EMPTY_BUFFER } = require('./constants');\n\n/**\n * Merges an array of buffers into a new buffer.\n *\n * @param {Buffer[]} list The array of buffers to concat\n * @param {Number} totalLength The total length of buffers in the list\n * @return {Buffer} The resulting buffer\n * @public\n */\nfunction concat(list, totalLength) {\n  if (list.length === 0) return EMPTY_BUFFER;\n  if (list.length === 1) return list[0];\n\n  const target = Buffer.allocUnsafe(totalLength);\n  let offset = 0;\n\n  for (let i = 0; i < list.length; i++) {\n    const buf = list[i];\n    target.set(buf, offset);\n    offset += buf.length;\n  }\n\n  if (offset < totalLength) return target.slice(0, offset);\n\n  return target;\n}\n\n/**\n * Masks a buffer using the given mask.\n *\n * @param {Buffer} source The buffer to mask\n * @param {Buffer} mask The mask to use\n * @param {Buffer} output The buffer where to store the result\n * @param {Number} offset The offset at which to start writing\n * @param {Number} length The number of bytes to mask.\n * @public\n */\nfunction _mask(source, mask, output, offset, length) {\n  for (let i = 0; i < length; i++) {\n    output[offset + i] = source[i] ^ mask[i & 3];\n  }\n}\n\n/**\n * Unmasks a buffer using the given mask.\n *\n * @param {Buffer} buffer The buffer to unmask\n * @param {Buffer} mask The mask to use\n * @public\n */\nfunction _unmask(buffer, mask) {\n  for (let i = 0; i < buffer.length; i++) {\n    buffer[i] ^= mask[i & 3];\n  }\n}\n\n/**\n * Converts a buffer to an `ArrayBuffer`.\n *\n * @param {Buffer} buf The buffer to convert\n * @return {ArrayBuffer} Converted buffer\n * @public\n */\nfunction toArrayBuffer(buf) {\n  if (buf.byteLength === buf.buffer.byteLength) {\n    return buf.buffer;\n  }\n\n  return buf.buffer.slice(buf.byteOffset, buf.byteOffset + buf.byteLength);\n}\n\n/**\n * Converts `data` to a `Buffer`.\n *\n * @param {*} data The data to convert\n * @return {Buffer} The buffer\n * @throws {TypeError}\n * @public\n */\nfunction toBuffer(data) {\n  toBuffer.readOnly = true;\n\n  if (Buffer.isBuffer(data)) return data;\n\n  let buf;\n\n  if (data instanceof ArrayBuffer) {\n    buf = Buffer.from(data);\n  } else if (ArrayBuffer.isView(data)) {\n    buf = Buffer.from(data.buffer, data.byteOffset, data.byteLength);\n  } else {\n    buf = Buffer.from(data);\n    toBuffer.readOnly = false;\n  }\n\n  return buf;\n}\n\ntry {\n  const bufferUtil = require('bufferutil');\n\n  module.exports = {\n    concat,\n    mask(source, mask, output, offset, length) {\n      if (length < 48) _mask(source, mask, output, offset, length);\n      else bufferUtil.mask(source, mask, output, offset, length);\n    },\n    toArrayBuffer,\n    toBuffer,\n    unmask(buffer, mask) {\n      if (buffer.length < 32) _unmask(buffer, mask);\n      else bufferUtil.unmask(buffer, mask);\n    }\n  };\n} catch (e) /* istanbul ignore next */ {\n  module.exports = {\n    concat,\n    mask: _mask,\n    toArrayBuffer,\n    toBuffer,\n    unmask: _unmask\n  };\n}\n","'use strict';\n\nmodule.exports = {\n  BINARY_TYPES: ['nodebuffer', 'arraybuffer', 'fragments'],\n  EMPTY_BUFFER: Buffer.alloc(0),\n  GUID: '258EAFA5-E914-47DA-95CA-C5AB0DC85B11',\n  kForOnEventAttribute: Symbol('kIsForOnEventAttribute'),\n  kListener: Symbol('kListener'),\n  kStatusCode: Symbol('status-code'),\n  kWebSocket: Symbol('websocket'),\n  NOOP: () => {}\n};\n","'use strict';\n\nconst { kForOnEventAttribute, kListener } = require('./constants');\n\nconst kCode = Symbol('kCode');\nconst kData = Symbol('kData');\nconst kError = Symbol('kError');\nconst kMessage = Symbol('kMessage');\nconst kReason = Symbol('kReason');\nconst kTarget = Symbol('kTarget');\nconst kType = Symbol('kType');\nconst kWasClean = Symbol('kWasClean');\n\n/**\n * Class representing an event.\n */\nclass Event {\n  /**\n   * Create a new `Event`.\n   *\n   * @param {String} type The name of the event\n   * @throws {TypeError} If the `type` argument is not specified\n   */\n  constructor(type) {\n    this[kTarget] = null;\n    this[kType] = type;\n  }\n\n  /**\n   * @type {*}\n   */\n  get target() {\n    return this[kTarget];\n  }\n\n  /**\n   * @type {String}\n   */\n  get type() {\n    return this[kType];\n  }\n}\n\nObject.defineProperty(Event.prototype, 'target', { enumerable: true });\nObject.defineProperty(Event.prototype, 'type', { enumerable: true });\n\n/**\n * Class representing a close event.\n *\n * @extends Event\n */\nclass CloseEvent extends Event {\n  /**\n   * Create a new `CloseEvent`.\n   *\n   * @param {String} type The name of the event\n   * @param {Object} [options] A dictionary object that allows for setting\n   *     attributes via object members of the same name\n   * @param {Number} [options.code=0] The status code explaining why the\n   *     connection was closed\n   * @param {String} [options.reason=''] A human-readable string explaining why\n   *     the connection was closed\n   * @param {Boolean} [options.wasClean=false] Indicates whether or not the\n   *     connection was cleanly closed\n   */\n  constructor(type, options = {}) {\n    super(type);\n\n    this[kCode] = options.code === undefined ? 0 : options.code;\n    this[kReason] = options.reason === undefined ? '' : options.reason;\n    this[kWasClean] = options.wasClean === undefined ? false : options.wasClean;\n  }\n\n  /**\n   * @type {Number}\n   */\n  get code() {\n    return this[kCode];\n  }\n\n  /**\n   * @type {String}\n   */\n  get reason() {\n    return this[kReason];\n  }\n\n  /**\n   * @type {Boolean}\n   */\n  get wasClean() {\n    return this[kWasClean];\n  }\n}\n\nObject.defineProperty(CloseEvent.prototype, 'code', { enumerable: true });\nObject.defineProperty(CloseEvent.prototype, 'reason', { enumerable: true });\nObject.defineProperty(CloseEvent.prototype, 'wasClean', { enumerable: true });\n\n/**\n * Class representing an error event.\n *\n * @extends Event\n */\nclass ErrorEvent extends Event {\n  /**\n   * Create a new `ErrorEvent`.\n   *\n   * @param {String} type The name of the event\n   * @param {Object} [options] A dictionary object that allows for setting\n   *     attributes via object members of the same name\n   * @param {*} [options.error=null] The error that generated this event\n   * @param {String} [options.message=''] The error message\n   */\n  constructor(type, options = {}) {\n    super(type);\n\n    this[kError] = options.error === undefined ? null : options.error;\n    this[kMessage] = options.message === undefined ? '' : options.message;\n  }\n\n  /**\n   * @type {*}\n   */\n  get error() {\n    return this[kError];\n  }\n\n  /**\n   * @type {String}\n   */\n  get message() {\n    return this[kMessage];\n  }\n}\n\nObject.defineProperty(ErrorEvent.prototype, 'error', { enumerable: true });\nObject.defineProperty(ErrorEvent.prototype, 'message', { enumerable: true });\n\n/**\n * Class representing a message event.\n *\n * @extends Event\n */\nclass MessageEvent extends Event {\n  /**\n   * Create a new `MessageEvent`.\n   *\n   * @param {String} type The name of the event\n   * @param {Object} [options] A dictionary object that allows for setting\n   *     attributes via object members of the same name\n   * @param {*} [options.data=null] The message content\n   */\n  constructor(type, options = {}) {\n    super(type);\n\n    this[kData] = options.data === undefined ? null : options.data;\n  }\n\n  /**\n   * @type {*}\n   */\n  get data() {\n    return this[kData];\n  }\n}\n\nObject.defineProperty(MessageEvent.prototype, 'data', { enumerable: true });\n\n/**\n * This provides methods for emulating the `EventTarget` interface. It's not\n * meant to be used directly.\n *\n * @mixin\n */\nconst EventTarget = {\n  /**\n   * Register an event listener.\n   *\n   * @param {String} type A string representing the event type to listen for\n   * @param {Function} listener The listener to add\n   * @param {Object} [options] An options object specifies characteristics about\n   *     the event listener\n   * @param {Boolean} [options.once=false] A `Boolean` indicating that the\n   *     listener should be invoked at most once after being added. If `true`,\n   *     the listener would be automatically removed when invoked.\n   * @public\n   */\n  addEventListener(type, listener, options = {}) {\n    let wrapper;\n\n    if (type === 'message') {\n      wrapper = function onMessage(data, isBinary) {\n        const event = new MessageEvent('message', {\n          data: isBinary ? data : data.toString()\n        });\n\n        event[kTarget] = this;\n        listener.call(this, event);\n      };\n    } else if (type === 'close') {\n      wrapper = function onClose(code, message) {\n        const event = new CloseEvent('close', {\n          code,\n          reason: message.toString(),\n          wasClean: this._closeFrameReceived && this._closeFrameSent\n        });\n\n        event[kTarget] = this;\n        listener.call(this, event);\n      };\n    } else if (type === 'error') {\n      wrapper = function onError(error) {\n        const event = new ErrorEvent('error', {\n          error,\n          message: error.message\n        });\n\n        event[kTarget] = this;\n        listener.call(this, event);\n      };\n    } else if (type === 'open') {\n      wrapper = function onOpen() {\n        const event = new Event('open');\n\n        event[kTarget] = this;\n        listener.call(this, event);\n      };\n    } else {\n      return;\n    }\n\n    wrapper[kForOnEventAttribute] = !!options[kForOnEventAttribute];\n    wrapper[kListener] = listener;\n\n    if (options.once) {\n      this.once(type, wrapper);\n    } else {\n      this.on(type, wrapper);\n    }\n  },\n\n  /**\n   * Remove an event listener.\n   *\n   * @param {String} type A string representing the event type to remove\n   * @param {Function} handler The listener to remove\n   * @public\n   */\n  removeEventListener(type, handler) {\n    for (const listener of this.listeners(type)) {\n      if (listener[kListener] === handler && !listener[kForOnEventAttribute]) {\n        this.removeListener(type, listener);\n        break;\n      }\n    }\n  }\n};\n\nmodule.exports = {\n  CloseEvent,\n  ErrorEvent,\n  Event,\n  EventTarget,\n  MessageEvent\n};\n","'use strict';\n\nconst { tokenChars } = require('./validation');\n\n/**\n * Adds an offer to the map of extension offers or a parameter to the map of\n * parameters.\n *\n * @param {Object} dest The map of extension offers or parameters\n * @param {String} name The extension or parameter name\n * @param {(Object|Boolean|String)} elem The extension parameters or the\n *     parameter value\n * @private\n */\nfunction push(dest, name, elem) {\n  if (dest[name] === undefined) dest[name] = [elem];\n  else dest[name].push(elem);\n}\n\n/**\n * Parses the `Sec-WebSocket-Extensions` header into an object.\n *\n * @param {String} header The field value of the header\n * @return {Object} The parsed object\n * @public\n */\nfunction parse(header) {\n  const offers = Object.create(null);\n  let params = Object.create(null);\n  let mustUnescape = false;\n  let isEscaping = false;\n  let inQuotes = false;\n  let extensionName;\n  let paramName;\n  let start = -1;\n  let code = -1;\n  let end = -1;\n  let i = 0;\n\n  for (; i < header.length; i++) {\n    code = header.charCodeAt(i);\n\n    if (extensionName === undefined) {\n      if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (\n        i !== 0 &&\n        (code === 0x20 /* ' ' */ || code === 0x09) /* '\\t' */\n      ) {\n        if (end === -1 && start !== -1) end = i;\n      } else if (code === 0x3b /* ';' */ || code === 0x2c /* ',' */) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        const name = header.slice(start, end);\n        if (code === 0x2c) {\n          push(offers, name, params);\n          params = Object.create(null);\n        } else {\n          extensionName = name;\n        }\n\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    } else if (paramName === undefined) {\n      if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (code === 0x20 || code === 0x09) {\n        if (end === -1 && start !== -1) end = i;\n      } else if (code === 0x3b || code === 0x2c) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        push(params, header.slice(start, end), true);\n        if (code === 0x2c) {\n          push(offers, extensionName, params);\n          params = Object.create(null);\n          extensionName = undefined;\n        }\n\n        start = end = -1;\n      } else if (code === 0x3d /* '=' */ && start !== -1 && end === -1) {\n        paramName = header.slice(start, i);\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    } else {\n      //\n      // The value of a quoted-string after unescaping must conform to the\n      // token ABNF, so only token characters are valid.\n      // Ref: https://tools.ietf.org/html/rfc6455#section-9.1\n      //\n      if (isEscaping) {\n        if (tokenChars[code] !== 1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n        if (start === -1) start = i;\n        else if (!mustUnescape) mustUnescape = true;\n        isEscaping = false;\n      } else if (inQuotes) {\n        if (tokenChars[code] === 1) {\n          if (start === -1) start = i;\n        } else if (code === 0x22 /* '\"' */ && start !== -1) {\n          inQuotes = false;\n          end = i;\n        } else if (code === 0x5c /* '\\' */) {\n          isEscaping = true;\n        } else {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n      } else if (code === 0x22 && header.charCodeAt(i - 1) === 0x3d) {\n        inQuotes = true;\n      } else if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (start !== -1 && (code === 0x20 || code === 0x09)) {\n        if (end === -1) end = i;\n      } else if (code === 0x3b || code === 0x2c) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        let value = header.slice(start, end);\n        if (mustUnescape) {\n          value = value.replace(/\\\\/g, '');\n          mustUnescape = false;\n        }\n        push(params, paramName, value);\n        if (code === 0x2c) {\n          push(offers, extensionName, params);\n          params = Object.create(null);\n          extensionName = undefined;\n        }\n\n        paramName = undefined;\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    }\n  }\n\n  if (start === -1 || inQuotes || code === 0x20 || code === 0x09) {\n    throw new SyntaxError('Unexpected end of input');\n  }\n\n  if (end === -1) end = i;\n  const token = header.slice(start, end);\n  if (extensionName === undefined) {\n    push(offers, token, params);\n  } else {\n    if (paramName === undefined) {\n      push(params, token, true);\n    } else if (mustUnescape) {\n      push(params, paramName, token.replace(/\\\\/g, ''));\n    } else {\n      push(params, paramName, token);\n    }\n    push(offers, extensionName, params);\n  }\n\n  return offers;\n}\n\n/**\n * Builds the `Sec-WebSocket-Extensions` header field value.\n *\n * @param {Object} extensions The map of extensions and parameters to format\n * @return {String} A string representing the given object\n * @public\n */\nfunction format(extensions) {\n  return Object.keys(extensions)\n    .map((extension) => {\n      let configurations = extensions[extension];\n      if (!Array.isArray(configurations)) configurations = [configurations];\n      return configurations\n        .map((params) => {\n          return [extension]\n            .concat(\n              Object.keys(params).map((k) => {\n                let values = params[k];\n                if (!Array.isArray(values)) values = [values];\n                return values\n                  .map((v) => (v === true ? k : `${k}=${v}`))\n                  .join('; ');\n              })\n            )\n            .join('; ');\n        })\n        .join(', ');\n    })\n    .join(', ');\n}\n\nmodule.exports = { format, parse };\n","'use strict';\n\nconst kDone = Symbol('kDone');\nconst kRun = Symbol('kRun');\n\n/**\n * A very simple job queue with adjustable concurrency. Adapted from\n * https://github.com/STRML/async-limiter\n */\nclass Limiter {\n  /**\n   * Creates a new `Limiter`.\n   *\n   * @param {Number} [concurrency=Infinity] The maximum number of jobs allowed\n   *     to run concurrently\n   */\n  constructor(concurrency) {\n    this[kDone] = () => {\n      this.pending--;\n      this[kRun]();\n    };\n    this.concurrency = concurrency || Infinity;\n    this.jobs = [];\n    this.pending = 0;\n  }\n\n  /**\n   * Adds a job to the queue.\n   *\n   * @param {Function} job The job to run\n   * @public\n   */\n  add(job) {\n    this.jobs.push(job);\n    this[kRun]();\n  }\n\n  /**\n   * Removes a job from the queue and runs it if possible.\n   *\n   * @private\n   */\n  [kRun]() {\n    if (this.pending === this.concurrency) return;\n\n    if (this.jobs.length) {\n      const job = this.jobs.shift();\n\n      this.pending++;\n      job(this[kDone]);\n    }\n  }\n}\n\nmodule.exports = Limiter;\n","'use strict';\n\nconst zlib = require('zlib');\n\nconst bufferUtil = require('./buffer-util');\nconst Limiter = require('./limiter');\nconst { kStatusCode } = require('./constants');\n\nconst TRAILER = Buffer.from([0x00, 0x00, 0xff, 0xff]);\nconst kPerMessageDeflate = Symbol('permessage-deflate');\nconst kTotalLength = Symbol('total-length');\nconst kCallback = Symbol('callback');\nconst kBuffers = Symbol('buffers');\nconst kError = Symbol('error');\n\n//\n// We limit zlib concurrency, which prevents severe memory fragmentation\n// as documented in https://github.com/nodejs/node/issues/8871#issuecomment-250915913\n// and https://github.com/websockets/ws/issues/1202\n//\n// Intentionally global; it's the global thread pool that's an issue.\n//\nlet zlibLimiter;\n\n/**\n * permessage-deflate implementation.\n */\nclass PerMessageDeflate {\n  /**\n   * Creates a PerMessageDeflate instance.\n   *\n   * @param {Object} [options] Configuration options\n   * @param {(Boolean|Number)} [options.clientMaxWindowBits] Advertise support\n   *     for, or request, a custom client window size\n   * @param {Boolean} [options.clientNoContextTakeover=false] Advertise/\n   *     acknowledge disabling of client context takeover\n   * @param {Number} [options.concurrencyLimit=10] The number of concurrent\n   *     calls to zlib\n   * @param {(Boolean|Number)} [options.serverMaxWindowBits] Request/confirm the\n   *     use of a custom server window size\n   * @param {Boolean} [options.serverNoContextTakeover=false] Request/accept\n   *     disabling of server context takeover\n   * @param {Number} [options.threshold=1024] Size (in bytes) below which\n   *     messages should not be compressed if context takeover is disabled\n   * @param {Object} [options.zlibDeflateOptions] Options to pass to zlib on\n   *     deflate\n   * @param {Object} [options.zlibInflateOptions] Options to pass to zlib on\n   *     inflate\n   * @param {Boolean} [isServer=false] Create the instance in either server or\n   *     client mode\n   * @param {Number} [maxPayload=0] The maximum allowed message length\n   */\n  constructor(options, isServer, maxPayload) {\n    this._maxPayload = maxPayload | 0;\n    this._options = options || {};\n    this._threshold =\n      this._options.threshold !== undefined ? this._options.threshold : 1024;\n    this._isServer = !!isServer;\n    this._deflate = null;\n    this._inflate = null;\n\n    this.params = null;\n\n    if (!zlibLimiter) {\n      const concurrency =\n        this._options.concurrencyLimit !== undefined\n          ? this._options.concurrencyLimit\n          : 10;\n      zlibLimiter = new Limiter(concurrency);\n    }\n  }\n\n  /**\n   * @type {String}\n   */\n  static get extensionName() {\n    return 'permessage-deflate';\n  }\n\n  /**\n   * Create an extension negotiation offer.\n   *\n   * @return {Object} Extension parameters\n   * @public\n   */\n  offer() {\n    const params = {};\n\n    if (this._options.serverNoContextTakeover) {\n      params.server_no_context_takeover = true;\n    }\n    if (this._options.clientNoContextTakeover) {\n      params.client_no_context_takeover = true;\n    }\n    if (this._options.serverMaxWindowBits) {\n      params.server_max_window_bits = this._options.serverMaxWindowBits;\n    }\n    if (this._options.clientMaxWindowBits) {\n      params.client_max_window_bits = this._options.clientMaxWindowBits;\n    } else if (this._options.clientMaxWindowBits == null) {\n      params.client_max_window_bits = true;\n    }\n\n    return params;\n  }\n\n  /**\n   * Accept an extension negotiation offer/response.\n   *\n   * @param {Array} configurations The extension negotiation offers/reponse\n   * @return {Object} Accepted configuration\n   * @public\n   */\n  accept(configurations) {\n    configurations = this.normalizeParams(configurations);\n\n    this.params = this._isServer\n      ? this.acceptAsServer(configurations)\n      : this.acceptAsClient(configurations);\n\n    return this.params;\n  }\n\n  /**\n   * Releases all resources used by the extension.\n   *\n   * @public\n   */\n  cleanup() {\n    if (this._inflate) {\n      this._inflate.close();\n      this._inflate = null;\n    }\n\n    if (this._deflate) {\n      const callback = this._deflate[kCallback];\n\n      this._deflate.close();\n      this._deflate = null;\n\n      if (callback) {\n        callback(\n          new Error(\n            'The deflate stream was closed while data was being processed'\n          )\n        );\n      }\n    }\n  }\n\n  /**\n   *  Accept an extension negotiation offer.\n   *\n   * @param {Array} offers The extension negotiation offers\n   * @return {Object} Accepted configuration\n   * @private\n   */\n  acceptAsServer(offers) {\n    const opts = this._options;\n    const accepted = offers.find((params) => {\n      if (\n        (opts.serverNoContextTakeover === false &&\n          params.server_no_context_takeover) ||\n        (params.server_max_window_bits &&\n          (opts.serverMaxWindowBits === false ||\n            (typeof opts.serverMaxWindowBits === 'number' &&\n              opts.serverMaxWindowBits > params.server_max_window_bits))) ||\n        (typeof opts.clientMaxWindowBits === 'number' &&\n          !params.client_max_window_bits)\n      ) {\n        return false;\n      }\n\n      return true;\n    });\n\n    if (!accepted) {\n      throw new Error('None of the extension offers can be accepted');\n    }\n\n    if (opts.serverNoContextTakeover) {\n      accepted.server_no_context_takeover = true;\n    }\n    if (opts.clientNoContextTakeover) {\n      accepted.client_no_context_takeover = true;\n    }\n    if (typeof opts.serverMaxWindowBits === 'number') {\n      accepted.server_max_window_bits = opts.serverMaxWindowBits;\n    }\n    if (typeof opts.clientMaxWindowBits === 'number') {\n      accepted.client_max_window_bits = opts.clientMaxWindowBits;\n    } else if (\n      accepted.client_max_window_bits === true ||\n      opts.clientMaxWindowBits === false\n    ) {\n      delete accepted.client_max_window_bits;\n    }\n\n    return accepted;\n  }\n\n  /**\n   * Accept the extension negotiation response.\n   *\n   * @param {Array} response The extension negotiation response\n   * @return {Object} Accepted configuration\n   * @private\n   */\n  acceptAsClient(response) {\n    const params = response[0];\n\n    if (\n      this._options.clientNoContextTakeover === false &&\n      params.client_no_context_takeover\n    ) {\n      throw new Error('Unexpected parameter \"client_no_context_takeover\"');\n    }\n\n    if (!params.client_max_window_bits) {\n      if (typeof this._options.clientMaxWindowBits === 'number') {\n        params.client_max_window_bits = this._options.clientMaxWindowBits;\n      }\n    } else if (\n      this._options.clientMaxWindowBits === false ||\n      (typeof this._options.clientMaxWindowBits === 'number' &&\n        params.client_max_window_bits > this._options.clientMaxWindowBits)\n    ) {\n      throw new Error(\n        'Unexpected or invalid parameter \"client_max_window_bits\"'\n      );\n    }\n\n    return params;\n  }\n\n  /**\n   * Normalize parameters.\n   *\n   * @param {Array} configurations The extension negotiation offers/reponse\n   * @return {Array} The offers/response with normalized parameters\n   * @private\n   */\n  normalizeParams(configurations) {\n    configurations.forEach((params) => {\n      Object.keys(params).forEach((key) => {\n        let value = params[key];\n\n        if (value.length > 1) {\n          throw new Error(`Parameter \"${key}\" must have only a single value`);\n        }\n\n        value = value[0];\n\n        if (key === 'client_max_window_bits') {\n          if (value !== true) {\n            const num = +value;\n            if (!Number.isInteger(num) || num < 8 || num > 15) {\n              throw new TypeError(\n                `Invalid value for parameter \"${key}\": ${value}`\n              );\n            }\n            value = num;\n          } else if (!this._isServer) {\n            throw new TypeError(\n              `Invalid value for parameter \"${key}\": ${value}`\n            );\n          }\n        } else if (key === 'server_max_window_bits') {\n          const num = +value;\n          if (!Number.isInteger(num) || num < 8 || num > 15) {\n            throw new TypeError(\n              `Invalid value for parameter \"${key}\": ${value}`\n            );\n          }\n          value = num;\n        } else if (\n          key === 'client_no_context_takeover' ||\n          key === 'server_no_context_takeover'\n        ) {\n          if (value !== true) {\n            throw new TypeError(\n              `Invalid value for parameter \"${key}\": ${value}`\n            );\n          }\n        } else {\n          throw new Error(`Unknown parameter \"${key}\"`);\n        }\n\n        params[key] = value;\n      });\n    });\n\n    return configurations;\n  }\n\n  /**\n   * Decompress data. Concurrency limited.\n   *\n   * @param {Buffer} data Compressed data\n   * @param {Boolean} fin Specifies whether or not this is the last fragment\n   * @param {Function} callback Callback\n   * @public\n   */\n  decompress(data, fin, callback) {\n    zlibLimiter.add((done) => {\n      this._decompress(data, fin, (err, result) => {\n        done();\n        callback(err, result);\n      });\n    });\n  }\n\n  /**\n   * Compress data. Concurrency limited.\n   *\n   * @param {(Buffer|String)} data Data to compress\n   * @param {Boolean} fin Specifies whether or not this is the last fragment\n   * @param {Function} callback Callback\n   * @public\n   */\n  compress(data, fin, callback) {\n    zlibLimiter.add((done) => {\n      this._compress(data, fin, (err, result) => {\n        done();\n        callback(err, result);\n      });\n    });\n  }\n\n  /**\n   * Decompress data.\n   *\n   * @param {Buffer} data Compressed data\n   * @param {Boolean} fin Specifies whether or not this is the last fragment\n   * @param {Function} callback Callback\n   * @private\n   */\n  _decompress(data, fin, callback) {\n    const endpoint = this._isServer ? 'client' : 'server';\n\n    if (!this._inflate) {\n      const key = `${endpoint}_max_window_bits`;\n      const windowBits =\n        typeof this.params[key] !== 'number'\n          ? zlib.Z_DEFAULT_WINDOWBITS\n          : this.params[key];\n\n      this._inflate = zlib.createInflateRaw({\n        ...this._options.zlibInflateOptions,\n        windowBits\n      });\n      this._inflate[kPerMessageDeflate] = this;\n      this._inflate[kTotalLength] = 0;\n      this._inflate[kBuffers] = [];\n      this._inflate.on('error', inflateOnError);\n      this._inflate.on('data', inflateOnData);\n    }\n\n    this._inflate[kCallback] = callback;\n\n    this._inflate.write(data);\n    if (fin) this._inflate.write(TRAILER);\n\n    this._inflate.flush(() => {\n      const err = this._inflate[kError];\n\n      if (err) {\n        this._inflate.close();\n        this._inflate = null;\n        callback(err);\n        return;\n      }\n\n      const data = bufferUtil.concat(\n        this._inflate[kBuffers],\n        this._inflate[kTotalLength]\n      );\n\n      if (this._inflate._readableState.endEmitted) {\n        this._inflate.close();\n        this._inflate = null;\n      } else {\n        this._inflate[kTotalLength] = 0;\n        this._inflate[kBuffers] = [];\n\n        if (fin && this.params[`${endpoint}_no_context_takeover`]) {\n          this._inflate.reset();\n        }\n      }\n\n      callback(null, data);\n    });\n  }\n\n  /**\n   * Compress data.\n   *\n   * @param {(Buffer|String)} data Data to compress\n   * @param {Boolean} fin Specifies whether or not this is the last fragment\n   * @param {Function} callback Callback\n   * @private\n   */\n  _compress(data, fin, callback) {\n    const endpoint = this._isServer ? 'server' : 'client';\n\n    if (!this._deflate) {\n      const key = `${endpoint}_max_window_bits`;\n      const windowBits =\n        typeof this.params[key] !== 'number'\n          ? zlib.Z_DEFAULT_WINDOWBITS\n          : this.params[key];\n\n      this._deflate = zlib.createDeflateRaw({\n        ...this._options.zlibDeflateOptions,\n        windowBits\n      });\n\n      this._deflate[kTotalLength] = 0;\n      this._deflate[kBuffers] = [];\n\n      this._deflate.on('data', deflateOnData);\n    }\n\n    this._deflate[kCallback] = callback;\n\n    this._deflate.write(data);\n    this._deflate.flush(zlib.Z_SYNC_FLUSH, () => {\n      if (!this._deflate) {\n        //\n        // The deflate stream was closed while data was being processed.\n        //\n        return;\n      }\n\n      let data = bufferUtil.concat(\n        this._deflate[kBuffers],\n        this._deflate[kTotalLength]\n      );\n\n      if (fin) data = data.slice(0, data.length - 4);\n\n      //\n      // Ensure that the callback will not be called again in\n      // `PerMessageDeflate#cleanup()`.\n      //\n      this._deflate[kCallback] = null;\n\n      this._deflate[kTotalLength] = 0;\n      this._deflate[kBuffers] = [];\n\n      if (fin && this.params[`${endpoint}_no_context_takeover`]) {\n        this._deflate.reset();\n      }\n\n      callback(null, data);\n    });\n  }\n}\n\nmodule.exports = PerMessageDeflate;\n\n/**\n * The listener of the `zlib.DeflateRaw` stream `'data'` event.\n *\n * @param {Buffer} chunk A chunk of data\n * @private\n */\nfunction deflateOnData(chunk) {\n  this[kBuffers].push(chunk);\n  this[kTotalLength] += chunk.length;\n}\n\n/**\n * The listener of the `zlib.InflateRaw` stream `'data'` event.\n *\n * @param {Buffer} chunk A chunk of data\n * @private\n */\nfunction inflateOnData(chunk) {\n  this[kTotalLength] += chunk.length;\n\n  if (\n    this[kPerMessageDeflate]._maxPayload < 1 ||\n    this[kTotalLength] <= this[kPerMessageDeflate]._maxPayload\n  ) {\n    this[kBuffers].push(chunk);\n    return;\n  }\n\n  this[kError] = new RangeError('Max payload size exceeded');\n  this[kError].code = 'WS_ERR_UNSUPPORTED_MESSAGE_LENGTH';\n  this[kError][kStatusCode] = 1009;\n  this.removeListener('data', inflateOnData);\n  this.reset();\n}\n\n/**\n * The listener of the `zlib.InflateRaw` stream `'error'` event.\n *\n * @param {Error} err The emitted error\n * @private\n */\nfunction inflateOnError(err) {\n  //\n  // There is no need to call `Zlib#close()` as the handle is automatically\n  // closed when an error is emitted.\n  //\n  this[kPerMessageDeflate]._inflate = null;\n  err[kStatusCode] = 1007;\n  this[kCallback](err);\n}\n","'use strict';\n\nconst { Writable } = require('stream');\n\nconst PerMessageDeflate = require('./permessage-deflate');\nconst {\n  BINARY_TYPES,\n  EMPTY_BUFFER,\n  kStatusCode,\n  kWebSocket\n} = require('./constants');\nconst { concat, toArrayBuffer, unmask } = require('./buffer-util');\nconst { isValidStatusCode, isValidUTF8 } = require('./validation');\n\nconst GET_INFO = 0;\nconst GET_PAYLOAD_LENGTH_16 = 1;\nconst GET_PAYLOAD_LENGTH_64 = 2;\nconst GET_MASK = 3;\nconst GET_DATA = 4;\nconst INFLATING = 5;\n\n/**\n * HyBi Receiver implementation.\n *\n * @extends Writable\n */\nclass Receiver extends Writable {\n  /**\n   * Creates a Receiver instance.\n   *\n   * @param {Object} [options] Options object\n   * @param {String} [options.binaryType=nodebuffer] The type for binary data\n   * @param {Object} [options.extensions] An object containing the negotiated\n   *     extensions\n   * @param {Boolean} [options.isServer=false] Specifies whether to operate in\n   *     client or server mode\n   * @param {Number} [options.maxPayload=0] The maximum allowed message length\n   * @param {Boolean} [options.skipUTF8Validation=false] Specifies whether or\n   *     not to skip UTF-8 validation for text and close messages\n   */\n  constructor(options = {}) {\n    super();\n\n    this._binaryType = options.binaryType || BINARY_TYPES[0];\n    this._extensions = options.extensions || {};\n    this._isServer = !!options.isServer;\n    this._maxPayload = options.maxPayload | 0;\n    this._skipUTF8Validation = !!options.skipUTF8Validation;\n    this[kWebSocket] = undefined;\n\n    this._bufferedBytes = 0;\n    this._buffers = [];\n\n    this._compressed = false;\n    this._payloadLength = 0;\n    this._mask = undefined;\n    this._fragmented = 0;\n    this._masked = false;\n    this._fin = false;\n    this._opcode = 0;\n\n    this._totalPayloadLength = 0;\n    this._messageLength = 0;\n    this._fragments = [];\n\n    this._state = GET_INFO;\n    this._loop = false;\n  }\n\n  /**\n   * Implements `Writable.prototype._write()`.\n   *\n   * @param {Buffer} chunk The chunk of data to write\n   * @param {String} encoding The character encoding of `chunk`\n   * @param {Function} cb Callback\n   * @private\n   */\n  _write(chunk, encoding, cb) {\n    if (this._opcode === 0x08 && this._state == GET_INFO) return cb();\n\n    this._bufferedBytes += chunk.length;\n    this._buffers.push(chunk);\n    this.startLoop(cb);\n  }\n\n  /**\n   * Consumes `n` bytes from the buffered data.\n   *\n   * @param {Number} n The number of bytes to consume\n   * @return {Buffer} The consumed bytes\n   * @private\n   */\n  consume(n) {\n    this._bufferedBytes -= n;\n\n    if (n === this._buffers[0].length) return this._buffers.shift();\n\n    if (n < this._buffers[0].length) {\n      const buf = this._buffers[0];\n      this._buffers[0] = buf.slice(n);\n      return buf.slice(0, n);\n    }\n\n    const dst = Buffer.allocUnsafe(n);\n\n    do {\n      const buf = this._buffers[0];\n      const offset = dst.length - n;\n\n      if (n >= buf.length) {\n        dst.set(this._buffers.shift(), offset);\n      } else {\n        dst.set(new Uint8Array(buf.buffer, buf.byteOffset, n), offset);\n        this._buffers[0] = buf.slice(n);\n      }\n\n      n -= buf.length;\n    } while (n > 0);\n\n    return dst;\n  }\n\n  /**\n   * Starts the parsing loop.\n   *\n   * @param {Function} cb Callback\n   * @private\n   */\n  startLoop(cb) {\n    let err;\n    this._loop = true;\n\n    do {\n      switch (this._state) {\n        case GET_INFO:\n          err = this.getInfo();\n          break;\n        case GET_PAYLOAD_LENGTH_16:\n          err = this.getPayloadLength16();\n          break;\n        case GET_PAYLOAD_LENGTH_64:\n          err = this.getPayloadLength64();\n          break;\n        case GET_MASK:\n          this.getMask();\n          break;\n        case GET_DATA:\n          err = this.getData(cb);\n          break;\n        default:\n          // `INFLATING`\n          this._loop = false;\n          return;\n      }\n    } while (this._loop);\n\n    cb(err);\n  }\n\n  /**\n   * Reads the first two bytes of a frame.\n   *\n   * @return {(RangeError|undefined)} A possible error\n   * @private\n   */\n  getInfo() {\n    if (this._bufferedBytes < 2) {\n      this._loop = false;\n      return;\n    }\n\n    const buf = this.consume(2);\n\n    if ((buf[0] & 0x30) !== 0x00) {\n      this._loop = false;\n      return error(\n        RangeError,\n        'RSV2 and RSV3 must be clear',\n        true,\n        1002,\n        'WS_ERR_UNEXPECTED_RSV_2_3'\n      );\n    }\n\n    const compressed = (buf[0] & 0x40) === 0x40;\n\n    if (compressed && !this._extensions[PerMessageDeflate.extensionName]) {\n      this._loop = false;\n      return error(\n        RangeError,\n        'RSV1 must be clear',\n        true,\n        1002,\n        'WS_ERR_UNEXPECTED_RSV_1'\n      );\n    }\n\n    this._fin = (buf[0] & 0x80) === 0x80;\n    this._opcode = buf[0] & 0x0f;\n    this._payloadLength = buf[1] & 0x7f;\n\n    if (this._opcode === 0x00) {\n      if (compressed) {\n        this._loop = false;\n        return error(\n          RangeError,\n          'RSV1 must be clear',\n          true,\n          1002,\n          'WS_ERR_UNEXPECTED_RSV_1'\n        );\n      }\n\n      if (!this._fragmented) {\n        this._loop = false;\n        return error(\n          RangeError,\n          'invalid opcode 0',\n          true,\n          1002,\n          'WS_ERR_INVALID_OPCODE'\n        );\n      }\n\n      this._opcode = this._fragmented;\n    } else if (this._opcode === 0x01 || this._opcode === 0x02) {\n      if (this._fragmented) {\n        this._loop = false;\n        return error(\n          RangeError,\n          `invalid opcode ${this._opcode}`,\n          true,\n          1002,\n          'WS_ERR_INVALID_OPCODE'\n        );\n      }\n\n      this._compressed = compressed;\n    } else if (this._opcode > 0x07 && this._opcode < 0x0b) {\n      if (!this._fin) {\n        this._loop = false;\n        return error(\n          RangeError,\n          'FIN must be set',\n          true,\n          1002,\n          'WS_ERR_EXPECTED_FIN'\n        );\n      }\n\n      if (compressed) {\n        this._loop = false;\n        return error(\n          RangeError,\n          'RSV1 must be clear',\n          true,\n          1002,\n          'WS_ERR_UNEXPECTED_RSV_1'\n        );\n      }\n\n      if (this._payloadLength > 0x7d) {\n        this._loop = false;\n        return error(\n          RangeError,\n          `invalid payload length ${this._payloadLength}`,\n          true,\n          1002,\n          'WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH'\n        );\n      }\n    } else {\n      this._loop = false;\n      return error(\n        RangeError,\n        `invalid opcode ${this._opcode}`,\n        true,\n        1002,\n        'WS_ERR_INVALID_OPCODE'\n      );\n    }\n\n    if (!this._fin && !this._fragmented) this._fragmented = this._opcode;\n    this._masked = (buf[1] & 0x80) === 0x80;\n\n    if (this._isServer) {\n      if (!this._masked) {\n        this._loop = false;\n        return error(\n          RangeError,\n          'MASK must be set',\n          true,\n          1002,\n          'WS_ERR_EXPECTED_MASK'\n        );\n      }\n    } else if (this._masked) {\n      this._loop = false;\n      return error(\n        RangeError,\n        'MASK must be clear',\n        true,\n        1002,\n        'WS_ERR_UNEXPECTED_MASK'\n      );\n    }\n\n    if (this._payloadLength === 126) this._state = GET_PAYLOAD_LENGTH_16;\n    else if (this._payloadLength === 127) this._state = GET_PAYLOAD_LENGTH_64;\n    else return this.haveLength();\n  }\n\n  /**\n   * Gets extended payload length (7+16).\n   *\n   * @return {(RangeError|undefined)} A possible error\n   * @private\n   */\n  getPayloadLength16() {\n    if (this._bufferedBytes < 2) {\n      this._loop = false;\n      return;\n    }\n\n    this._payloadLength = this.consume(2).readUInt16BE(0);\n    return this.haveLength();\n  }\n\n  /**\n   * Gets extended payload length (7+64).\n   *\n   * @return {(RangeError|undefined)} A possible error\n   * @private\n   */\n  getPayloadLength64() {\n    if (this._bufferedBytes < 8) {\n      this._loop = false;\n      return;\n    }\n\n    const buf = this.consume(8);\n    const num = buf.readUInt32BE(0);\n\n    //\n    // The maximum safe integer in JavaScript is 2^53 - 1. An error is returned\n    // if payload length is greater than this number.\n    //\n    if (num > Math.pow(2, 53 - 32) - 1) {\n      this._loop = false;\n      return error(\n        RangeError,\n        'Unsupported WebSocket frame: payload length > 2^53 - 1',\n        false,\n        1009,\n        'WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH'\n      );\n    }\n\n    this._payloadLength = num * Math.pow(2, 32) + buf.readUInt32BE(4);\n    return this.haveLength();\n  }\n\n  /**\n   * Payload length has been read.\n   *\n   * @return {(RangeError|undefined)} A possible error\n   * @private\n   */\n  haveLength() {\n    if (this._payloadLength && this._opcode < 0x08) {\n      this._totalPayloadLength += this._payloadLength;\n      if (this._totalPayloadLength > this._maxPayload && this._maxPayload > 0) {\n        this._loop = false;\n        return error(\n          RangeError,\n          'Max payload size exceeded',\n          false,\n          1009,\n          'WS_ERR_UNSUPPORTED_MESSAGE_LENGTH'\n        );\n      }\n    }\n\n    if (this._masked) this._state = GET_MASK;\n    else this._state = GET_DATA;\n  }\n\n  /**\n   * Reads mask bytes.\n   *\n   * @private\n   */\n  getMask() {\n    if (this._bufferedBytes < 4) {\n      this._loop = false;\n      return;\n    }\n\n    this._mask = this.consume(4);\n    this._state = GET_DATA;\n  }\n\n  /**\n   * Reads data bytes.\n   *\n   * @param {Function} cb Callback\n   * @return {(Error|RangeError|undefined)} A possible error\n   * @private\n   */\n  getData(cb) {\n    let data = EMPTY_BUFFER;\n\n    if (this._payloadLength) {\n      if (this._bufferedBytes < this._payloadLength) {\n        this._loop = false;\n        return;\n      }\n\n      data = this.consume(this._payloadLength);\n\n      if (\n        this._masked &&\n        (this._mask[0] | this._mask[1] | this._mask[2] | this._mask[3]) !== 0\n      ) {\n        unmask(data, this._mask);\n      }\n    }\n\n    if (this._opcode > 0x07) return this.controlMessage(data);\n\n    if (this._compressed) {\n      this._state = INFLATING;\n      this.decompress(data, cb);\n      return;\n    }\n\n    if (data.length) {\n      //\n      // This message is not compressed so its length is the sum of the payload\n      // length of all fragments.\n      //\n      this._messageLength = this._totalPayloadLength;\n      this._fragments.push(data);\n    }\n\n    return this.dataMessage();\n  }\n\n  /**\n   * Decompresses data.\n   *\n   * @param {Buffer} data Compressed data\n   * @param {Function} cb Callback\n   * @private\n   */\n  decompress(data, cb) {\n    const perMessageDeflate = this._extensions[PerMessageDeflate.extensionName];\n\n    perMessageDeflate.decompress(data, this._fin, (err, buf) => {\n      if (err) return cb(err);\n\n      if (buf.length) {\n        this._messageLength += buf.length;\n        if (this._messageLength > this._maxPayload && this._maxPayload > 0) {\n          return cb(\n            error(\n              RangeError,\n              'Max payload size exceeded',\n              false,\n              1009,\n              'WS_ERR_UNSUPPORTED_MESSAGE_LENGTH'\n            )\n          );\n        }\n\n        this._fragments.push(buf);\n      }\n\n      const er = this.dataMessage();\n      if (er) return cb(er);\n\n      this.startLoop(cb);\n    });\n  }\n\n  /**\n   * Handles a data message.\n   *\n   * @return {(Error|undefined)} A possible error\n   * @private\n   */\n  dataMessage() {\n    if (this._fin) {\n      const messageLength = this._messageLength;\n      const fragments = this._fragments;\n\n      this._totalPayloadLength = 0;\n      this._messageLength = 0;\n      this._fragmented = 0;\n      this._fragments = [];\n\n      if (this._opcode === 2) {\n        let data;\n\n        if (this._binaryType === 'nodebuffer') {\n          data = concat(fragments, messageLength);\n        } else if (this._binaryType === 'arraybuffer') {\n          data = toArrayBuffer(concat(fragments, messageLength));\n        } else {\n          data = fragments;\n        }\n\n        this.emit('message', data, true);\n      } else {\n        const buf = concat(fragments, messageLength);\n\n        if (!this._skipUTF8Validation && !isValidUTF8(buf)) {\n          this._loop = false;\n          return error(\n            Error,\n            'invalid UTF-8 sequence',\n            true,\n            1007,\n            'WS_ERR_INVALID_UTF8'\n          );\n        }\n\n        this.emit('message', buf, false);\n      }\n    }\n\n    this._state = GET_INFO;\n  }\n\n  /**\n   * Handles a control message.\n   *\n   * @param {Buffer} data Data to handle\n   * @return {(Error|RangeError|undefined)} A possible error\n   * @private\n   */\n  controlMessage(data) {\n    if (this._opcode === 0x08) {\n      this._loop = false;\n\n      if (data.length === 0) {\n        this.emit('conclude', 1005, EMPTY_BUFFER);\n        this.end();\n      } else if (data.length === 1) {\n        return error(\n          RangeError,\n          'invalid payload length 1',\n          true,\n          1002,\n          'WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH'\n        );\n      } else {\n        const code = data.readUInt16BE(0);\n\n        if (!isValidStatusCode(code)) {\n          return error(\n            RangeError,\n            `invalid status code ${code}`,\n            true,\n            1002,\n            'WS_ERR_INVALID_CLOSE_CODE'\n          );\n        }\n\n        const buf = data.slice(2);\n\n        if (!this._skipUTF8Validation && !isValidUTF8(buf)) {\n          return error(\n            Error,\n            'invalid UTF-8 sequence',\n            true,\n            1007,\n            'WS_ERR_INVALID_UTF8'\n          );\n        }\n\n        this.emit('conclude', code, buf);\n        this.end();\n      }\n    } else if (this._opcode === 0x09) {\n      this.emit('ping', data);\n    } else {\n      this.emit('pong', data);\n    }\n\n    this._state = GET_INFO;\n  }\n}\n\nmodule.exports = Receiver;\n\n/**\n * Builds an error object.\n *\n * @param {function(new:Error|RangeError)} ErrorCtor The error constructor\n * @param {String} message The error message\n * @param {Boolean} prefix Specifies whether or not to add a default prefix to\n *     `message`\n * @param {Number} statusCode The status code\n * @param {String} errorCode The exposed error code\n * @return {(Error|RangeError)} The error\n * @private\n */\nfunction error(ErrorCtor, message, prefix, statusCode, errorCode) {\n  const err = new ErrorCtor(\n    prefix ? `Invalid WebSocket frame: ${message}` : message\n  );\n\n  Error.captureStackTrace(err, error);\n  err.code = errorCode;\n  err[kStatusCode] = statusCode;\n  return err;\n}\n","/* eslint no-unused-vars: [\"error\", { \"varsIgnorePattern\": \"^net|tls$\" }] */\n\n'use strict';\n\nconst net = require('net');\nconst tls = require('tls');\nconst { randomFillSync } = require('crypto');\n\nconst PerMessageDeflate = require('./permessage-deflate');\nconst { EMPTY_BUFFER } = require('./constants');\nconst { isValidStatusCode } = require('./validation');\nconst { mask: applyMask, toBuffer } = require('./buffer-util');\n\nconst kByteLength = Symbol('kByteLength');\nconst maskBuffer = Buffer.alloc(4);\n\n/**\n * HyBi Sender implementation.\n */\nclass Sender {\n  /**\n   * Creates a Sender instance.\n   *\n   * @param {(net.Socket|tls.Socket)} socket The connection socket\n   * @param {Object} [extensions] An object containing the negotiated extensions\n   * @param {Function} [generateMask] The function used to generate the masking\n   *     key\n   */\n  constructor(socket, extensions, generateMask) {\n    this._extensions = extensions || {};\n\n    if (generateMask) {\n      this._generateMask = generateMask;\n      this._maskBuffer = Buffer.alloc(4);\n    }\n\n    this._socket = socket;\n\n    this._firstFragment = true;\n    this._compress = false;\n\n    this._bufferedBytes = 0;\n    this._deflating = false;\n    this._queue = [];\n  }\n\n  /**\n   * Frames a piece of data according to the HyBi WebSocket protocol.\n   *\n   * @param {(Buffer|String)} data The data to frame\n   * @param {Object} options Options object\n   * @param {Boolean} [options.fin=false] Specifies whether or not to set the\n   *     FIN bit\n   * @param {Function} [options.generateMask] The function used to generate the\n   *     masking key\n   * @param {Boolean} [options.mask=false] Specifies whether or not to mask\n   *     `data`\n   * @param {Buffer} [options.maskBuffer] The buffer used to store the masking\n   *     key\n   * @param {Number} options.opcode The opcode\n   * @param {Boolean} [options.readOnly=false] Specifies whether `data` can be\n   *     modified\n   * @param {Boolean} [options.rsv1=false] Specifies whether or not to set the\n   *     RSV1 bit\n   * @return {(Buffer|String)[]} The framed data\n   * @public\n   */\n  static frame(data, options) {\n    let mask;\n    let merge = false;\n    let offset = 2;\n    let skipMasking = false;\n\n    if (options.mask) {\n      mask = options.maskBuffer || maskBuffer;\n\n      if (options.generateMask) {\n        options.generateMask(mask);\n      } else {\n        randomFillSync(mask, 0, 4);\n      }\n\n      skipMasking = (mask[0] | mask[1] | mask[2] | mask[3]) === 0;\n      offset = 6;\n    }\n\n    let dataLength;\n\n    if (typeof data === 'string') {\n      if (\n        (!options.mask || skipMasking) &&\n        options[kByteLength] !== undefined\n      ) {\n        dataLength = options[kByteLength];\n      } else {\n        data = Buffer.from(data);\n        dataLength = data.length;\n      }\n    } else {\n      dataLength = data.length;\n      merge = options.mask && options.readOnly && !skipMasking;\n    }\n\n    let payloadLength = dataLength;\n\n    if (dataLength >= 65536) {\n      offset += 8;\n      payloadLength = 127;\n    } else if (dataLength > 125) {\n      offset += 2;\n      payloadLength = 126;\n    }\n\n    const target = Buffer.allocUnsafe(merge ? dataLength + offset : offset);\n\n    target[0] = options.fin ? options.opcode | 0x80 : options.opcode;\n    if (options.rsv1) target[0] |= 0x40;\n\n    target[1] = payloadLength;\n\n    if (payloadLength === 126) {\n      target.writeUInt16BE(dataLength, 2);\n    } else if (payloadLength === 127) {\n      target[2] = target[3] = 0;\n      target.writeUIntBE(dataLength, 4, 6);\n    }\n\n    if (!options.mask) return [target, data];\n\n    target[1] |= 0x80;\n    target[offset - 4] = mask[0];\n    target[offset - 3] = mask[1];\n    target[offset - 2] = mask[2];\n    target[offset - 1] = mask[3];\n\n    if (skipMasking) return [target, data];\n\n    if (merge) {\n      applyMask(data, mask, target, offset, dataLength);\n      return [target];\n    }\n\n    applyMask(data, mask, data, 0, dataLength);\n    return [target, data];\n  }\n\n  /**\n   * Sends a close message to the other peer.\n   *\n   * @param {Number} [code] The status code component of the body\n   * @param {(String|Buffer)} [data] The message component of the body\n   * @param {Boolean} [mask=false] Specifies whether or not to mask the message\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  close(code, data, mask, cb) {\n    let buf;\n\n    if (code === undefined) {\n      buf = EMPTY_BUFFER;\n    } else if (typeof code !== 'number' || !isValidStatusCode(code)) {\n      throw new TypeError('First argument must be a valid error code number');\n    } else if (data === undefined || !data.length) {\n      buf = Buffer.allocUnsafe(2);\n      buf.writeUInt16BE(code, 0);\n    } else {\n      const length = Buffer.byteLength(data);\n\n      if (length > 123) {\n        throw new RangeError('The message must not be greater than 123 bytes');\n      }\n\n      buf = Buffer.allocUnsafe(2 + length);\n      buf.writeUInt16BE(code, 0);\n\n      if (typeof data === 'string') {\n        buf.write(data, 2);\n      } else {\n        buf.set(data, 2);\n      }\n    }\n\n    const options = {\n      [kByteLength]: buf.length,\n      fin: true,\n      generateMask: this._generateMask,\n      mask,\n      maskBuffer: this._maskBuffer,\n      opcode: 0x08,\n      readOnly: false,\n      rsv1: false\n    };\n\n    if (this._deflating) {\n      this.enqueue([this.dispatch, buf, false, options, cb]);\n    } else {\n      this.sendFrame(Sender.frame(buf, options), cb);\n    }\n  }\n\n  /**\n   * Sends a ping message to the other peer.\n   *\n   * @param {*} data The message to send\n   * @param {Boolean} [mask=false] Specifies whether or not to mask `data`\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  ping(data, mask, cb) {\n    let byteLength;\n    let readOnly;\n\n    if (typeof data === 'string') {\n      byteLength = Buffer.byteLength(data);\n      readOnly = false;\n    } else {\n      data = toBuffer(data);\n      byteLength = data.length;\n      readOnly = toBuffer.readOnly;\n    }\n\n    if (byteLength > 125) {\n      throw new RangeError('The data size must not be greater than 125 bytes');\n    }\n\n    const options = {\n      [kByteLength]: byteLength,\n      fin: true,\n      generateMask: this._generateMask,\n      mask,\n      maskBuffer: this._maskBuffer,\n      opcode: 0x09,\n      readOnly,\n      rsv1: false\n    };\n\n    if (this._deflating) {\n      this.enqueue([this.dispatch, data, false, options, cb]);\n    } else {\n      this.sendFrame(Sender.frame(data, options), cb);\n    }\n  }\n\n  /**\n   * Sends a pong message to the other peer.\n   *\n   * @param {*} data The message to send\n   * @param {Boolean} [mask=false] Specifies whether or not to mask `data`\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  pong(data, mask, cb) {\n    let byteLength;\n    let readOnly;\n\n    if (typeof data === 'string') {\n      byteLength = Buffer.byteLength(data);\n      readOnly = false;\n    } else {\n      data = toBuffer(data);\n      byteLength = data.length;\n      readOnly = toBuffer.readOnly;\n    }\n\n    if (byteLength > 125) {\n      throw new RangeError('The data size must not be greater than 125 bytes');\n    }\n\n    const options = {\n      [kByteLength]: byteLength,\n      fin: true,\n      generateMask: this._generateMask,\n      mask,\n      maskBuffer: this._maskBuffer,\n      opcode: 0x0a,\n      readOnly,\n      rsv1: false\n    };\n\n    if (this._deflating) {\n      this.enqueue([this.dispatch, data, false, options, cb]);\n    } else {\n      this.sendFrame(Sender.frame(data, options), cb);\n    }\n  }\n\n  /**\n   * Sends a data message to the other peer.\n   *\n   * @param {*} data The message to send\n   * @param {Object} options Options object\n   * @param {Boolean} [options.binary=false] Specifies whether `data` is binary\n   *     or text\n   * @param {Boolean} [options.compress=false] Specifies whether or not to\n   *     compress `data`\n   * @param {Boolean} [options.fin=false] Specifies whether the fragment is the\n   *     last one\n   * @param {Boolean} [options.mask=false] Specifies whether or not to mask\n   *     `data`\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  send(data, options, cb) {\n    const perMessageDeflate = this._extensions[PerMessageDeflate.extensionName];\n    let opcode = options.binary ? 2 : 1;\n    let rsv1 = options.compress;\n\n    let byteLength;\n    let readOnly;\n\n    if (typeof data === 'string') {\n      byteLength = Buffer.byteLength(data);\n      readOnly = false;\n    } else {\n      data = toBuffer(data);\n      byteLength = data.length;\n      readOnly = toBuffer.readOnly;\n    }\n\n    if (this._firstFragment) {\n      this._firstFragment = false;\n      if (\n        rsv1 &&\n        perMessageDeflate &&\n        perMessageDeflate.params[\n          perMessageDeflate._isServer\n            ? 'server_no_context_takeover'\n            : 'client_no_context_takeover'\n        ]\n      ) {\n        rsv1 = byteLength >= perMessageDeflate._threshold;\n      }\n      this._compress = rsv1;\n    } else {\n      rsv1 = false;\n      opcode = 0;\n    }\n\n    if (options.fin) this._firstFragment = true;\n\n    if (perMessageDeflate) {\n      const opts = {\n        [kByteLength]: byteLength,\n        fin: options.fin,\n        generateMask: this._generateMask,\n        mask: options.mask,\n        maskBuffer: this._maskBuffer,\n        opcode,\n        readOnly,\n        rsv1\n      };\n\n      if (this._deflating) {\n        this.enqueue([this.dispatch, data, this._compress, opts, cb]);\n      } else {\n        this.dispatch(data, this._compress, opts, cb);\n      }\n    } else {\n      this.sendFrame(\n        Sender.frame(data, {\n          [kByteLength]: byteLength,\n          fin: options.fin,\n          generateMask: this._generateMask,\n          mask: options.mask,\n          maskBuffer: this._maskBuffer,\n          opcode,\n          readOnly,\n          rsv1: false\n        }),\n        cb\n      );\n    }\n  }\n\n  /**\n   * Dispatches a message.\n   *\n   * @param {(Buffer|String)} data The message to send\n   * @param {Boolean} [compress=false] Specifies whether or not to compress\n   *     `data`\n   * @param {Object} options Options object\n   * @param {Boolean} [options.fin=false] Specifies whether or not to set the\n   *     FIN bit\n   * @param {Function} [options.generateMask] The function used to generate the\n   *     masking key\n   * @param {Boolean} [options.mask=false] Specifies whether or not to mask\n   *     `data`\n   * @param {Buffer} [options.maskBuffer] The buffer used to store the masking\n   *     key\n   * @param {Number} options.opcode The opcode\n   * @param {Boolean} [options.readOnly=false] Specifies whether `data` can be\n   *     modified\n   * @param {Boolean} [options.rsv1=false] Specifies whether or not to set the\n   *     RSV1 bit\n   * @param {Function} [cb] Callback\n   * @private\n   */\n  dispatch(data, compress, options, cb) {\n    if (!compress) {\n      this.sendFrame(Sender.frame(data, options), cb);\n      return;\n    }\n\n    const perMessageDeflate = this._extensions[PerMessageDeflate.extensionName];\n\n    this._bufferedBytes += options[kByteLength];\n    this._deflating = true;\n    perMessageDeflate.compress(data, options.fin, (_, buf) => {\n      if (this._socket.destroyed) {\n        const err = new Error(\n          'The socket was closed while data was being compressed'\n        );\n\n        if (typeof cb === 'function') cb(err);\n\n        for (let i = 0; i < this._queue.length; i++) {\n          const params = this._queue[i];\n          const callback = params[params.length - 1];\n\n          if (typeof callback === 'function') callback(err);\n        }\n\n        return;\n      }\n\n      this._bufferedBytes -= options[kByteLength];\n      this._deflating = false;\n      options.readOnly = false;\n      this.sendFrame(Sender.frame(buf, options), cb);\n      this.dequeue();\n    });\n  }\n\n  /**\n   * Executes queued send operations.\n   *\n   * @private\n   */\n  dequeue() {\n    while (!this._deflating && this._queue.length) {\n      const params = this._queue.shift();\n\n      this._bufferedBytes -= params[3][kByteLength];\n      Reflect.apply(params[0], this, params.slice(1));\n    }\n  }\n\n  /**\n   * Enqueues a send operation.\n   *\n   * @param {Array} params Send operation parameters.\n   * @private\n   */\n  enqueue(params) {\n    this._bufferedBytes += params[3][kByteLength];\n    this._queue.push(params);\n  }\n\n  /**\n   * Sends a frame.\n   *\n   * @param {Buffer[]} list The frame to send\n   * @param {Function} [cb] Callback\n   * @private\n   */\n  sendFrame(list, cb) {\n    if (list.length === 2) {\n      this._socket.cork();\n      this._socket.write(list[0]);\n      this._socket.write(list[1], cb);\n      this._socket.uncork();\n    } else {\n      this._socket.write(list[0], cb);\n    }\n  }\n}\n\nmodule.exports = Sender;\n","'use strict';\n\nconst { Duplex } = require('stream');\n\n/**\n * Emits the `'close'` event on a stream.\n *\n * @param {Duplex} stream The stream.\n * @private\n */\nfunction emitClose(stream) {\n  stream.emit('close');\n}\n\n/**\n * The listener of the `'end'` event.\n *\n * @private\n */\nfunction duplexOnEnd() {\n  if (!this.destroyed && this._writableState.finished) {\n    this.destroy();\n  }\n}\n\n/**\n * The listener of the `'error'` event.\n *\n * @param {Error} err The error\n * @private\n */\nfunction duplexOnError(err) {\n  this.removeListener('error', duplexOnError);\n  this.destroy();\n  if (this.listenerCount('error') === 0) {\n    // Do not suppress the throwing behavior.\n    this.emit('error', err);\n  }\n}\n\n/**\n * Wraps a `WebSocket` in a duplex stream.\n *\n * @param {WebSocket} ws The `WebSocket` to wrap\n * @param {Object} [options] The options for the `Duplex` constructor\n * @return {Duplex} The duplex stream\n * @public\n */\nfunction createWebSocketStream(ws, options) {\n  let terminateOnDestroy = true;\n\n  const duplex = new Duplex({\n    ...options,\n    autoDestroy: false,\n    emitClose: false,\n    objectMode: false,\n    writableObjectMode: false\n  });\n\n  ws.on('message', function message(msg, isBinary) {\n    const data =\n      !isBinary && duplex._readableState.objectMode ? msg.toString() : msg;\n\n    if (!duplex.push(data)) ws.pause();\n  });\n\n  ws.once('error', function error(err) {\n    if (duplex.destroyed) return;\n\n    // Prevent `ws.terminate()` from being called by `duplex._destroy()`.\n    //\n    // - If the `'error'` event is emitted before the `'open'` event, then\n    //   `ws.terminate()` is a noop as no socket is assigned.\n    // - Otherwise, the error is re-emitted by the listener of the `'error'`\n    //   event of the `Receiver` object. The listener already closes the\n    //   connection by calling `ws.close()`. This allows a close frame to be\n    //   sent to the other peer. If `ws.terminate()` is called right after this,\n    //   then the close frame might not be sent.\n    terminateOnDestroy = false;\n    duplex.destroy(err);\n  });\n\n  ws.once('close', function close() {\n    if (duplex.destroyed) return;\n\n    duplex.push(null);\n  });\n\n  duplex._destroy = function (err, callback) {\n    if (ws.readyState === ws.CLOSED) {\n      callback(err);\n      process.nextTick(emitClose, duplex);\n      return;\n    }\n\n    let called = false;\n\n    ws.once('error', function error(err) {\n      called = true;\n      callback(err);\n    });\n\n    ws.once('close', function close() {\n      if (!called) callback(err);\n      process.nextTick(emitClose, duplex);\n    });\n\n    if (terminateOnDestroy) ws.terminate();\n  };\n\n  duplex._final = function (callback) {\n    if (ws.readyState === ws.CONNECTING) {\n      ws.once('open', function open() {\n        duplex._final(callback);\n      });\n      return;\n    }\n\n    // If the value of the `_socket` property is `null` it means that `ws` is a\n    // client websocket and the handshake failed. In fact, when this happens, a\n    // socket is never assigned to the websocket. Wait for the `'error'` event\n    // that will be emitted by the websocket.\n    if (ws._socket === null) return;\n\n    if (ws._socket._writableState.finished) {\n      callback();\n      if (duplex._readableState.endEmitted) duplex.destroy();\n    } else {\n      ws._socket.once('finish', function finish() {\n        // `duplex` is not destroyed here because the `'end'` event will be\n        // emitted on `duplex` after this `'finish'` event. The EOF signaling\n        // `null` chunk is, in fact, pushed when the websocket emits `'close'`.\n        callback();\n      });\n      ws.close();\n    }\n  };\n\n  duplex._read = function () {\n    if (ws.isPaused) ws.resume();\n  };\n\n  duplex._write = function (chunk, encoding, callback) {\n    if (ws.readyState === ws.CONNECTING) {\n      ws.once('open', function open() {\n        duplex._write(chunk, encoding, callback);\n      });\n      return;\n    }\n\n    ws.send(chunk, callback);\n  };\n\n  duplex.on('end', duplexOnEnd);\n  duplex.on('error', duplexOnError);\n  return duplex;\n}\n\nmodule.exports = createWebSocketStream;\n","'use strict';\n\nconst { tokenChars } = require('./validation');\n\n/**\n * Parses the `Sec-WebSocket-Protocol` header into a set of subprotocol names.\n *\n * @param {String} header The field value of the header\n * @return {Set} The subprotocol names\n * @public\n */\nfunction parse(header) {\n  const protocols = new Set();\n  let start = -1;\n  let end = -1;\n  let i = 0;\n\n  for (i; i < header.length; i++) {\n    const code = header.charCodeAt(i);\n\n    if (end === -1 && tokenChars[code] === 1) {\n      if (start === -1) start = i;\n    } else if (\n      i !== 0 &&\n      (code === 0x20 /* ' ' */ || code === 0x09) /* '\\t' */\n    ) {\n      if (end === -1 && start !== -1) end = i;\n    } else if (code === 0x2c /* ',' */) {\n      if (start === -1) {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n\n      if (end === -1) end = i;\n\n      const protocol = header.slice(start, end);\n\n      if (protocols.has(protocol)) {\n        throw new SyntaxError(`The \"${protocol}\" subprotocol is duplicated`);\n      }\n\n      protocols.add(protocol);\n      start = end = -1;\n    } else {\n      throw new SyntaxError(`Unexpected character at index ${i}`);\n    }\n  }\n\n  if (start === -1 || end !== -1) {\n    throw new SyntaxError('Unexpected end of input');\n  }\n\n  const protocol = header.slice(start, i);\n\n  if (protocols.has(protocol)) {\n    throw new SyntaxError(`The \"${protocol}\" subprotocol is duplicated`);\n  }\n\n  protocols.add(protocol);\n  return protocols;\n}\n\nmodule.exports = { parse };\n","'use strict';\n\n//\n// Allowed token characters:\n//\n// '!', '#', '$', '%', '&', ''', '*', '+', '-',\n// '.', 0-9, A-Z, '^', '_', '`', a-z, '|', '~'\n//\n// tokenChars[32] === 0 // ' '\n// tokenChars[33] === 1 // '!'\n// tokenChars[34] === 0 // '\"'\n// ...\n//\n// prettier-ignore\nconst tokenChars = [\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 0 - 15\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 16 - 31\n  0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, // 32 - 47\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, // 48 - 63\n  0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, // 64 - 79\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, // 80 - 95\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, // 96 - 111\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0 // 112 - 127\n];\n\n/**\n * Checks if a status code is allowed in a close frame.\n *\n * @param {Number} code The status code\n * @return {Boolean} `true` if the status code is valid, else `false`\n * @public\n */\nfunction isValidStatusCode(code) {\n  return (\n    (code >= 1000 &&\n      code <= 1014 &&\n      code !== 1004 &&\n      code !== 1005 &&\n      code !== 1006) ||\n    (code >= 3000 && code <= 4999)\n  );\n}\n\n/**\n * Checks if a given buffer contains only correct UTF-8.\n * Ported from https://www.cl.cam.ac.uk/%7Emgk25/ucs/utf8_check.c by\n * Markus Kuhn.\n *\n * @param {Buffer} buf The buffer to check\n * @return {Boolean} `true` if `buf` contains only correct UTF-8, else `false`\n * @public\n */\nfunction _isValidUTF8(buf) {\n  const len = buf.length;\n  let i = 0;\n\n  while (i < len) {\n    if ((buf[i] & 0x80) === 0) {\n      // 0xxxxxxx\n      i++;\n    } else if ((buf[i] & 0xe0) === 0xc0) {\n      // 110xxxxx 10xxxxxx\n      if (\n        i + 1 === len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i] & 0xfe) === 0xc0 // Overlong\n      ) {\n        return false;\n      }\n\n      i += 2;\n    } else if ((buf[i] & 0xf0) === 0xe0) {\n      // 1110xxxx 10xxxxxx 10xxxxxx\n      if (\n        i + 2 >= len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i + 2] & 0xc0) !== 0x80 ||\n        (buf[i] === 0xe0 && (buf[i + 1] & 0xe0) === 0x80) || // Overlong\n        (buf[i] === 0xed && (buf[i + 1] & 0xe0) === 0xa0) // Surrogate (U+D800 - U+DFFF)\n      ) {\n        return false;\n      }\n\n      i += 3;\n    } else if ((buf[i] & 0xf8) === 0xf0) {\n      // 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx\n      if (\n        i + 3 >= len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i + 2] & 0xc0) !== 0x80 ||\n        (buf[i + 3] & 0xc0) !== 0x80 ||\n        (buf[i] === 0xf0 && (buf[i + 1] & 0xf0) === 0x80) || // Overlong\n        (buf[i] === 0xf4 && buf[i + 1] > 0x8f) ||\n        buf[i] > 0xf4 // > U+10FFFF\n      ) {\n        return false;\n      }\n\n      i += 4;\n    } else {\n      return false;\n    }\n  }\n\n  return true;\n}\n\ntry {\n  const isValidUTF8 = require('utf-8-validate');\n\n  module.exports = {\n    isValidStatusCode,\n    isValidUTF8(buf) {\n      return buf.length < 150 ? _isValidUTF8(buf) : isValidUTF8(buf);\n    },\n    tokenChars\n  };\n} catch (e) /* istanbul ignore next */ {\n  module.exports = {\n    isValidStatusCode,\n    isValidUTF8: _isValidUTF8,\n    tokenChars\n  };\n}\n","/* eslint no-unused-vars: [\"error\", { \"varsIgnorePattern\": \"^net|tls|https$\" }] */\n\n'use strict';\n\nconst EventEmitter = require('events');\nconst http = require('http');\nconst https = require('https');\nconst net = require('net');\nconst tls = require('tls');\nconst { createHash } = require('crypto');\n\nconst extension = require('./extension');\nconst PerMessageDeflate = require('./permessage-deflate');\nconst subprotocol = require('./subprotocol');\nconst WebSocket = require('./websocket');\nconst { GUID, kWebSocket } = require('./constants');\n\nconst keyRegex = /^[+/0-9A-Za-z]{22}==$/;\n\nconst RUNNING = 0;\nconst CLOSING = 1;\nconst CLOSED = 2;\n\n/**\n * Class representing a WebSocket server.\n *\n * @extends EventEmitter\n */\nclass WebSocketServer extends EventEmitter {\n  /**\n   * Create a `WebSocketServer` instance.\n   *\n   * @param {Object} options Configuration options\n   * @param {Number} [options.backlog=511] The maximum length of the queue of\n   *     pending connections\n   * @param {Boolean} [options.clientTracking=true] Specifies whether or not to\n   *     track clients\n   * @param {Function} [options.handleProtocols] A hook to handle protocols\n   * @param {String} [options.host] The hostname where to bind the server\n   * @param {Number} [options.maxPayload=104857600] The maximum allowed message\n   *     size\n   * @param {Boolean} [options.noServer=false] Enable no server mode\n   * @param {String} [options.path] Accept only connections matching this path\n   * @param {(Boolean|Object)} [options.perMessageDeflate=false] Enable/disable\n   *     permessage-deflate\n   * @param {Number} [options.port] The port where to bind the server\n   * @param {(http.Server|https.Server)} [options.server] A pre-created HTTP/S\n   *     server to use\n   * @param {Boolean} [options.skipUTF8Validation=false] Specifies whether or\n   *     not to skip UTF-8 validation for text and close messages\n   * @param {Function} [options.verifyClient] A hook to reject connections\n   * @param {Function} [options.WebSocket=WebSocket] Specifies the `WebSocket`\n   *     class to use. It must be the `WebSocket` class or class that extends it\n   * @param {Function} [callback] A listener for the `listening` event\n   */\n  constructor(options, callback) {\n    super();\n\n    options = {\n      maxPayload: 100 * 1024 * 1024,\n      skipUTF8Validation: false,\n      perMessageDeflate: false,\n      handleProtocols: null,\n      clientTracking: true,\n      verifyClient: null,\n      noServer: false,\n      backlog: null, // use default (511 as implemented in net.js)\n      server: null,\n      host: null,\n      path: null,\n      port: null,\n      WebSocket,\n      ...options\n    };\n\n    if (\n      (options.port == null && !options.server && !options.noServer) ||\n      (options.port != null && (options.server || options.noServer)) ||\n      (options.server && options.noServer)\n    ) {\n      throw new TypeError(\n        'One and only one of the \"port\", \"server\", or \"noServer\" options ' +\n          'must be specified'\n      );\n    }\n\n    if (options.port != null) {\n      this._server = http.createServer((req, res) => {\n        const body = http.STATUS_CODES[426];\n\n        res.writeHead(426, {\n          'Content-Length': body.length,\n          'Content-Type': 'text/plain'\n        });\n        res.end(body);\n      });\n      this._server.listen(\n        options.port,\n        options.host,\n        options.backlog,\n        callback\n      );\n    } else if (options.server) {\n      this._server = options.server;\n    }\n\n    if (this._server) {\n      const emitConnection = this.emit.bind(this, 'connection');\n\n      this._removeListeners = addListeners(this._server, {\n        listening: this.emit.bind(this, 'listening'),\n        error: this.emit.bind(this, 'error'),\n        upgrade: (req, socket, head) => {\n          this.handleUpgrade(req, socket, head, emitConnection);\n        }\n      });\n    }\n\n    if (options.perMessageDeflate === true) options.perMessageDeflate = {};\n    if (options.clientTracking) {\n      this.clients = new Set();\n      this._shouldEmitClose = false;\n    }\n\n    this.options = options;\n    this._state = RUNNING;\n  }\n\n  /**\n   * Returns the bound address, the address family name, and port of the server\n   * as reported by the operating system if listening on an IP socket.\n   * If the server is listening on a pipe or UNIX domain socket, the name is\n   * returned as a string.\n   *\n   * @return {(Object|String|null)} The address of the server\n   * @public\n   */\n  address() {\n    if (this.options.noServer) {\n      throw new Error('The server is operating in \"noServer\" mode');\n    }\n\n    if (!this._server) return null;\n    return this._server.address();\n  }\n\n  /**\n   * Stop the server from accepting new connections and emit the `'close'` event\n   * when all existing connections are closed.\n   *\n   * @param {Function} [cb] A one-time listener for the `'close'` event\n   * @public\n   */\n  close(cb) {\n    if (this._state === CLOSED) {\n      if (cb) {\n        this.once('close', () => {\n          cb(new Error('The server is not running'));\n        });\n      }\n\n      process.nextTick(emitClose, this);\n      return;\n    }\n\n    if (cb) this.once('close', cb);\n\n    if (this._state === CLOSING) return;\n    this._state = CLOSING;\n\n    if (this.options.noServer || this.options.server) {\n      if (this._server) {\n        this._removeListeners();\n        this._removeListeners = this._server = null;\n      }\n\n      if (this.clients) {\n        if (!this.clients.size) {\n          process.nextTick(emitClose, this);\n        } else {\n          this._shouldEmitClose = true;\n        }\n      } else {\n        process.nextTick(emitClose, this);\n      }\n    } else {\n      const server = this._server;\n\n      this._removeListeners();\n      this._removeListeners = this._server = null;\n\n      //\n      // The HTTP/S server was created internally. Close it, and rely on its\n      // `'close'` event.\n      //\n      server.close(() => {\n        emitClose(this);\n      });\n    }\n  }\n\n  /**\n   * See if a given request should be handled by this server instance.\n   *\n   * @param {http.IncomingMessage} req Request object to inspect\n   * @return {Boolean} `true` if the request is valid, else `false`\n   * @public\n   */\n  shouldHandle(req) {\n    if (this.options.path) {\n      const index = req.url.indexOf('?');\n      const pathname = index !== -1 ? req.url.slice(0, index) : req.url;\n\n      if (pathname !== this.options.path) return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Handle a HTTP Upgrade request.\n   *\n   * @param {http.IncomingMessage} req The request object\n   * @param {(net.Socket|tls.Socket)} socket The network socket between the\n   *     server and client\n   * @param {Buffer} head The first packet of the upgraded stream\n   * @param {Function} cb Callback\n   * @public\n   */\n  handleUpgrade(req, socket, head, cb) {\n    socket.on('error', socketOnError);\n\n    const key =\n      req.headers['sec-websocket-key'] !== undefined\n        ? req.headers['sec-websocket-key']\n        : false;\n    const version = +req.headers['sec-websocket-version'];\n\n    if (\n      req.method !== 'GET' ||\n      req.headers.upgrade.toLowerCase() !== 'websocket' ||\n      !key ||\n      !keyRegex.test(key) ||\n      (version !== 8 && version !== 13) ||\n      !this.shouldHandle(req)\n    ) {\n      return abortHandshake(socket, 400);\n    }\n\n    const secWebSocketProtocol = req.headers['sec-websocket-protocol'];\n    let protocols = new Set();\n\n    if (secWebSocketProtocol !== undefined) {\n      try {\n        protocols = subprotocol.parse(secWebSocketProtocol);\n      } catch (err) {\n        return abortHandshake(socket, 400);\n      }\n    }\n\n    const secWebSocketExtensions = req.headers['sec-websocket-extensions'];\n    const extensions = {};\n\n    if (\n      this.options.perMessageDeflate &&\n      secWebSocketExtensions !== undefined\n    ) {\n      const perMessageDeflate = new PerMessageDeflate(\n        this.options.perMessageDeflate,\n        true,\n        this.options.maxPayload\n      );\n\n      try {\n        const offers = extension.parse(secWebSocketExtensions);\n\n        if (offers[PerMessageDeflate.extensionName]) {\n          perMessageDeflate.accept(offers[PerMessageDeflate.extensionName]);\n          extensions[PerMessageDeflate.extensionName] = perMessageDeflate;\n        }\n      } catch (err) {\n        return abortHandshake(socket, 400);\n      }\n    }\n\n    //\n    // Optionally call external client verification handler.\n    //\n    if (this.options.verifyClient) {\n      const info = {\n        origin:\n          req.headers[`${version === 8 ? 'sec-websocket-origin' : 'origin'}`],\n        secure: !!(req.socket.authorized || req.socket.encrypted),\n        req\n      };\n\n      if (this.options.verifyClient.length === 2) {\n        this.options.verifyClient(info, (verified, code, message, headers) => {\n          if (!verified) {\n            return abortHandshake(socket, code || 401, message, headers);\n          }\n\n          this.completeUpgrade(\n            extensions,\n            key,\n            protocols,\n            req,\n            socket,\n            head,\n            cb\n          );\n        });\n        return;\n      }\n\n      if (!this.options.verifyClient(info)) return abortHandshake(socket, 401);\n    }\n\n    this.completeUpgrade(extensions, key, protocols, req, socket, head, cb);\n  }\n\n  /**\n   * Upgrade the connection to WebSocket.\n   *\n   * @param {Object} extensions The accepted extensions\n   * @param {String} key The value of the `Sec-WebSocket-Key` header\n   * @param {Set} protocols The subprotocols\n   * @param {http.IncomingMessage} req The request object\n   * @param {(net.Socket|tls.Socket)} socket The network socket between the\n   *     server and client\n   * @param {Buffer} head The first packet of the upgraded stream\n   * @param {Function} cb Callback\n   * @throws {Error} If called more than once with the same socket\n   * @private\n   */\n  completeUpgrade(extensions, key, protocols, req, socket, head, cb) {\n    //\n    // Destroy the socket if the client has already sent a FIN packet.\n    //\n    if (!socket.readable || !socket.writable) return socket.destroy();\n\n    if (socket[kWebSocket]) {\n      throw new Error(\n        'server.handleUpgrade() was called more than once with the same ' +\n          'socket, possibly due to a misconfiguration'\n      );\n    }\n\n    if (this._state > RUNNING) return abortHandshake(socket, 503);\n\n    const digest = createHash('sha1')\n      .update(key + GUID)\n      .digest('base64');\n\n    const headers = [\n      'HTTP/1.1 101 Switching Protocols',\n      'Upgrade: websocket',\n      'Connection: Upgrade',\n      `Sec-WebSocket-Accept: ${digest}`\n    ];\n\n    const ws = new this.options.WebSocket(null);\n\n    if (protocols.size) {\n      //\n      // Optionally call external protocol selection handler.\n      //\n      const protocol = this.options.handleProtocols\n        ? this.options.handleProtocols(protocols, req)\n        : protocols.values().next().value;\n\n      if (protocol) {\n        headers.push(`Sec-WebSocket-Protocol: ${protocol}`);\n        ws._protocol = protocol;\n      }\n    }\n\n    if (extensions[PerMessageDeflate.extensionName]) {\n      const params = extensions[PerMessageDeflate.extensionName].params;\n      const value = extension.format({\n        [PerMessageDeflate.extensionName]: [params]\n      });\n      headers.push(`Sec-WebSocket-Extensions: ${value}`);\n      ws._extensions = extensions;\n    }\n\n    //\n    // Allow external modification/inspection of handshake headers.\n    //\n    this.emit('headers', headers, req);\n\n    socket.write(headers.concat('\\r\\n').join('\\r\\n'));\n    socket.removeListener('error', socketOnError);\n\n    ws.setSocket(socket, head, {\n      maxPayload: this.options.maxPayload,\n      skipUTF8Validation: this.options.skipUTF8Validation\n    });\n\n    if (this.clients) {\n      this.clients.add(ws);\n      ws.on('close', () => {\n        this.clients.delete(ws);\n\n        if (this._shouldEmitClose && !this.clients.size) {\n          process.nextTick(emitClose, this);\n        }\n      });\n    }\n\n    cb(ws, req);\n  }\n}\n\nmodule.exports = WebSocketServer;\n\n/**\n * Add event listeners on an `EventEmitter` using a map of <event, listener>\n * pairs.\n *\n * @param {EventEmitter} server The event emitter\n * @param {Object.<String, Function>} map The listeners to add\n * @return {Function} A function that will remove the added listeners when\n *     called\n * @private\n */\nfunction addListeners(server, map) {\n  for (const event of Object.keys(map)) server.on(event, map[event]);\n\n  return function removeListeners() {\n    for (const event of Object.keys(map)) {\n      server.removeListener(event, map[event]);\n    }\n  };\n}\n\n/**\n * Emit a `'close'` event on an `EventEmitter`.\n *\n * @param {EventEmitter} server The event emitter\n * @private\n */\nfunction emitClose(server) {\n  server._state = CLOSED;\n  server.emit('close');\n}\n\n/**\n * Handle premature socket errors.\n *\n * @private\n */\nfunction socketOnError() {\n  this.destroy();\n}\n\n/**\n * Close the connection when preconditions are not fulfilled.\n *\n * @param {(net.Socket|tls.Socket)} socket The socket of the upgrade request\n * @param {Number} code The HTTP response status code\n * @param {String} [message] The HTTP response body\n * @param {Object} [headers] Additional HTTP response headers\n * @private\n */\nfunction abortHandshake(socket, code, message, headers) {\n  if (socket.writable) {\n    message = message || http.STATUS_CODES[code];\n    headers = {\n      Connection: 'close',\n      'Content-Type': 'text/html',\n      'Content-Length': Buffer.byteLength(message),\n      ...headers\n    };\n\n    socket.write(\n      `HTTP/1.1 ${code} ${http.STATUS_CODES[code]}\\r\\n` +\n        Object.keys(headers)\n          .map((h) => `${h}: ${headers[h]}`)\n          .join('\\r\\n') +\n        '\\r\\n\\r\\n' +\n        message\n    );\n  }\n\n  socket.removeListener('error', socketOnError);\n  socket.destroy();\n}\n","/* eslint no-unused-vars: [\"error\", { \"varsIgnorePattern\": \"^Readable$\" }] */\n\n'use strict';\n\nconst EventEmitter = require('events');\nconst https = require('https');\nconst http = require('http');\nconst net = require('net');\nconst tls = require('tls');\nconst { randomBytes, createHash } = require('crypto');\nconst { Readable } = require('stream');\nconst { URL } = require('url');\n\nconst PerMessageDeflate = require('./permessage-deflate');\nconst Receiver = require('./receiver');\nconst Sender = require('./sender');\nconst {\n  BINARY_TYPES,\n  EMPTY_BUFFER,\n  GUID,\n  kForOnEventAttribute,\n  kListener,\n  kStatusCode,\n  kWebSocket,\n  NOOP\n} = require('./constants');\nconst {\n  EventTarget: { addEventListener, removeEventListener }\n} = require('./event-target');\nconst { format, parse } = require('./extension');\nconst { toBuffer } = require('./buffer-util');\n\nconst readyStates = ['CONNECTING', 'OPEN', 'CLOSING', 'CLOSED'];\nconst subprotocolRegex = /^[!#$%&'*+\\-.0-9A-Z^_`|a-z~]+$/;\nconst protocolVersions = [8, 13];\nconst closeTimeout = 30 * 1000;\n\n/**\n * Class representing a WebSocket.\n *\n * @extends EventEmitter\n */\nclass WebSocket extends EventEmitter {\n  /**\n   * Create a new `WebSocket`.\n   *\n   * @param {(String|URL)} address The URL to which to connect\n   * @param {(String|String[])} [protocols] The subprotocols\n   * @param {Object} [options] Connection options\n   */\n  constructor(address, protocols, options) {\n    super();\n\n    this._binaryType = BINARY_TYPES[0];\n    this._closeCode = 1006;\n    this._closeFrameReceived = false;\n    this._closeFrameSent = false;\n    this._closeMessage = EMPTY_BUFFER;\n    this._closeTimer = null;\n    this._extensions = {};\n    this._paused = false;\n    this._protocol = '';\n    this._readyState = WebSocket.CONNECTING;\n    this._receiver = null;\n    this._sender = null;\n    this._socket = null;\n\n    if (address !== null) {\n      this._bufferedAmount = 0;\n      this._isServer = false;\n      this._redirects = 0;\n\n      if (protocols === undefined) {\n        protocols = [];\n      } else if (!Array.isArray(protocols)) {\n        if (typeof protocols === 'object' && protocols !== null) {\n          options = protocols;\n          protocols = [];\n        } else {\n          protocols = [protocols];\n        }\n      }\n\n      initAsClient(this, address, protocols, options);\n    } else {\n      this._isServer = true;\n    }\n  }\n\n  /**\n   * This deviates from the WHATWG interface since ws doesn't support the\n   * required default \"blob\" type (instead we define a custom \"nodebuffer\"\n   * type).\n   *\n   * @type {String}\n   */\n  get binaryType() {\n    return this._binaryType;\n  }\n\n  set binaryType(type) {\n    if (!BINARY_TYPES.includes(type)) return;\n\n    this._binaryType = type;\n\n    //\n    // Allow to change `binaryType` on the fly.\n    //\n    if (this._receiver) this._receiver._binaryType = type;\n  }\n\n  /**\n   * @type {Number}\n   */\n  get bufferedAmount() {\n    if (!this._socket) return this._bufferedAmount;\n\n    return this._socket._writableState.length + this._sender._bufferedBytes;\n  }\n\n  /**\n   * @type {String}\n   */\n  get extensions() {\n    return Object.keys(this._extensions).join();\n  }\n\n  /**\n   * @type {Boolean}\n   */\n  get isPaused() {\n    return this._paused;\n  }\n\n  /**\n   * @type {Function}\n   */\n  /* istanbul ignore next */\n  get onclose() {\n    return null;\n  }\n\n  /**\n   * @type {Function}\n   */\n  /* istanbul ignore next */\n  get onerror() {\n    return null;\n  }\n\n  /**\n   * @type {Function}\n   */\n  /* istanbul ignore next */\n  get onopen() {\n    return null;\n  }\n\n  /**\n   * @type {Function}\n   */\n  /* istanbul ignore next */\n  get onmessage() {\n    return null;\n  }\n\n  /**\n   * @type {String}\n   */\n  get protocol() {\n    return this._protocol;\n  }\n\n  /**\n   * @type {Number}\n   */\n  get readyState() {\n    return this._readyState;\n  }\n\n  /**\n   * @type {String}\n   */\n  get url() {\n    return this._url;\n  }\n\n  /**\n   * Set up the socket and the internal resources.\n   *\n   * @param {(net.Socket|tls.Socket)} socket The network socket between the\n   *     server and client\n   * @param {Buffer} head The first packet of the upgraded stream\n   * @param {Object} options Options object\n   * @param {Function} [options.generateMask] The function used to generate the\n   *     masking key\n   * @param {Number} [options.maxPayload=0] The maximum allowed message size\n   * @param {Boolean} [options.skipUTF8Validation=false] Specifies whether or\n   *     not to skip UTF-8 validation for text and close messages\n   * @private\n   */\n  setSocket(socket, head, options) {\n    const receiver = new Receiver({\n      binaryType: this.binaryType,\n      extensions: this._extensions,\n      isServer: this._isServer,\n      maxPayload: options.maxPayload,\n      skipUTF8Validation: options.skipUTF8Validation\n    });\n\n    this._sender = new Sender(socket, this._extensions, options.generateMask);\n    this._receiver = receiver;\n    this._socket = socket;\n\n    receiver[kWebSocket] = this;\n    socket[kWebSocket] = this;\n\n    receiver.on('conclude', receiverOnConclude);\n    receiver.on('drain', receiverOnDrain);\n    receiver.on('error', receiverOnError);\n    receiver.on('message', receiverOnMessage);\n    receiver.on('ping', receiverOnPing);\n    receiver.on('pong', receiverOnPong);\n\n    socket.setTimeout(0);\n    socket.setNoDelay();\n\n    if (head.length > 0) socket.unshift(head);\n\n    socket.on('close', socketOnClose);\n    socket.on('data', socketOnData);\n    socket.on('end', socketOnEnd);\n    socket.on('error', socketOnError);\n\n    this._readyState = WebSocket.OPEN;\n    this.emit('open');\n  }\n\n  /**\n   * Emit the `'close'` event.\n   *\n   * @private\n   */\n  emitClose() {\n    if (!this._socket) {\n      this._readyState = WebSocket.CLOSED;\n      this.emit('close', this._closeCode, this._closeMessage);\n      return;\n    }\n\n    if (this._extensions[PerMessageDeflate.extensionName]) {\n      this._extensions[PerMessageDeflate.extensionName].cleanup();\n    }\n\n    this._receiver.removeAllListeners();\n    this._readyState = WebSocket.CLOSED;\n    this.emit('close', this._closeCode, this._closeMessage);\n  }\n\n  /**\n   * Start a closing handshake.\n   *\n   *          +----------+   +-----------+   +----------+\n   *     - - -|ws.close()|-->|close frame|-->|ws.close()|- - -\n   *    |     +----------+   +-----------+   +----------+     |\n   *          +----------+   +-----------+         |\n   * CLOSING  |ws.close()|<--|close frame|<--+-----+       CLOSING\n   *          +----------+   +-----------+   |\n   *    |           |                        |   +---+        |\n   *                +------------------------+-->|fin| - - - -\n   *    |         +---+                      |   +---+\n   *     - - - - -|fin|<---------------------+\n   *              +---+\n   *\n   * @param {Number} [code] Status code explaining why the connection is closing\n   * @param {(String|Buffer)} [data] The reason why the connection is\n   *     closing\n   * @public\n   */\n  close(code, data) {\n    if (this.readyState === WebSocket.CLOSED) return;\n    if (this.readyState === WebSocket.CONNECTING) {\n      const msg = 'WebSocket was closed before the connection was established';\n      return abortHandshake(this, this._req, msg);\n    }\n\n    if (this.readyState === WebSocket.CLOSING) {\n      if (\n        this._closeFrameSent &&\n        (this._closeFrameReceived || this._receiver._writableState.errorEmitted)\n      ) {\n        this._socket.end();\n      }\n\n      return;\n    }\n\n    this._readyState = WebSocket.CLOSING;\n    this._sender.close(code, data, !this._isServer, (err) => {\n      //\n      // This error is handled by the `'error'` listener on the socket. We only\n      // want to know if the close frame has been sent here.\n      //\n      if (err) return;\n\n      this._closeFrameSent = true;\n\n      if (\n        this._closeFrameReceived ||\n        this._receiver._writableState.errorEmitted\n      ) {\n        this._socket.end();\n      }\n    });\n\n    //\n    // Specify a timeout for the closing handshake to complete.\n    //\n    this._closeTimer = setTimeout(\n      this._socket.destroy.bind(this._socket),\n      closeTimeout\n    );\n  }\n\n  /**\n   * Pause the socket.\n   *\n   * @public\n   */\n  pause() {\n    if (\n      this.readyState === WebSocket.CONNECTING ||\n      this.readyState === WebSocket.CLOSED\n    ) {\n      return;\n    }\n\n    this._paused = true;\n    this._socket.pause();\n  }\n\n  /**\n   * Send a ping.\n   *\n   * @param {*} [data] The data to send\n   * @param {Boolean} [mask] Indicates whether or not to mask `data`\n   * @param {Function} [cb] Callback which is executed when the ping is sent\n   * @public\n   */\n  ping(data, mask, cb) {\n    if (this.readyState === WebSocket.CONNECTING) {\n      throw new Error('WebSocket is not open: readyState 0 (CONNECTING)');\n    }\n\n    if (typeof data === 'function') {\n      cb = data;\n      data = mask = undefined;\n    } else if (typeof mask === 'function') {\n      cb = mask;\n      mask = undefined;\n    }\n\n    if (typeof data === 'number') data = data.toString();\n\n    if (this.readyState !== WebSocket.OPEN) {\n      sendAfterClose(this, data, cb);\n      return;\n    }\n\n    if (mask === undefined) mask = !this._isServer;\n    this._sender.ping(data || EMPTY_BUFFER, mask, cb);\n  }\n\n  /**\n   * Send a pong.\n   *\n   * @param {*} [data] The data to send\n   * @param {Boolean} [mask] Indicates whether or not to mask `data`\n   * @param {Function} [cb] Callback which is executed when the pong is sent\n   * @public\n   */\n  pong(data, mask, cb) {\n    if (this.readyState === WebSocket.CONNECTING) {\n      throw new Error('WebSocket is not open: readyState 0 (CONNECTING)');\n    }\n\n    if (typeof data === 'function') {\n      cb = data;\n      data = mask = undefined;\n    } else if (typeof mask === 'function') {\n      cb = mask;\n      mask = undefined;\n    }\n\n    if (typeof data === 'number') data = data.toString();\n\n    if (this.readyState !== WebSocket.OPEN) {\n      sendAfterClose(this, data, cb);\n      return;\n    }\n\n    if (mask === undefined) mask = !this._isServer;\n    this._sender.pong(data || EMPTY_BUFFER, mask, cb);\n  }\n\n  /**\n   * Resume the socket.\n   *\n   * @public\n   */\n  resume() {\n    if (\n      this.readyState === WebSocket.CONNECTING ||\n      this.readyState === WebSocket.CLOSED\n    ) {\n      return;\n    }\n\n    this._paused = false;\n    if (!this._receiver._writableState.needDrain) this._socket.resume();\n  }\n\n  /**\n   * Send a data message.\n   *\n   * @param {*} data The message to send\n   * @param {Object} [options] Options object\n   * @param {Boolean} [options.binary] Specifies whether `data` is binary or\n   *     text\n   * @param {Boolean} [options.compress] Specifies whether or not to compress\n   *     `data`\n   * @param {Boolean} [options.fin=true] Specifies whether the fragment is the\n   *     last one\n   * @param {Boolean} [options.mask] Specifies whether or not to mask `data`\n   * @param {Function} [cb] Callback which is executed when data is written out\n   * @public\n   */\n  send(data, options, cb) {\n    if (this.readyState === WebSocket.CONNECTING) {\n      throw new Error('WebSocket is not open: readyState 0 (CONNECTING)');\n    }\n\n    if (typeof options === 'function') {\n      cb = options;\n      options = {};\n    }\n\n    if (typeof data === 'number') data = data.toString();\n\n    if (this.readyState !== WebSocket.OPEN) {\n      sendAfterClose(this, data, cb);\n      return;\n    }\n\n    const opts = {\n      binary: typeof data !== 'string',\n      mask: !this._isServer,\n      compress: true,\n      fin: true,\n      ...options\n    };\n\n    if (!this._extensions[PerMessageDeflate.extensionName]) {\n      opts.compress = false;\n    }\n\n    this._sender.send(data || EMPTY_BUFFER, opts, cb);\n  }\n\n  /**\n   * Forcibly close the connection.\n   *\n   * @public\n   */\n  terminate() {\n    if (this.readyState === WebSocket.CLOSED) return;\n    if (this.readyState === WebSocket.CONNECTING) {\n      const msg = 'WebSocket was closed before the connection was established';\n      return abortHandshake(this, this._req, msg);\n    }\n\n    if (this._socket) {\n      this._readyState = WebSocket.CLOSING;\n      this._socket.destroy();\n    }\n  }\n}\n\n/**\n * @constant {Number} CONNECTING\n * @memberof WebSocket\n */\nObject.defineProperty(WebSocket, 'CONNECTING', {\n  enumerable: true,\n  value: readyStates.indexOf('CONNECTING')\n});\n\n/**\n * @constant {Number} CONNECTING\n * @memberof WebSocket.prototype\n */\nObject.defineProperty(WebSocket.prototype, 'CONNECTING', {\n  enumerable: true,\n  value: readyStates.indexOf('CONNECTING')\n});\n\n/**\n * @constant {Number} OPEN\n * @memberof WebSocket\n */\nObject.defineProperty(WebSocket, 'OPEN', {\n  enumerable: true,\n  value: readyStates.indexOf('OPEN')\n});\n\n/**\n * @constant {Number} OPEN\n * @memberof WebSocket.prototype\n */\nObject.defineProperty(WebSocket.prototype, 'OPEN', {\n  enumerable: true,\n  value: readyStates.indexOf('OPEN')\n});\n\n/**\n * @constant {Number} CLOSING\n * @memberof WebSocket\n */\nObject.defineProperty(WebSocket, 'CLOSING', {\n  enumerable: true,\n  value: readyStates.indexOf('CLOSING')\n});\n\n/**\n * @constant {Number} CLOSING\n * @memberof WebSocket.prototype\n */\nObject.defineProperty(WebSocket.prototype, 'CLOSING', {\n  enumerable: true,\n  value: readyStates.indexOf('CLOSING')\n});\n\n/**\n * @constant {Number} CLOSED\n * @memberof WebSocket\n */\nObject.defineProperty(WebSocket, 'CLOSED', {\n  enumerable: true,\n  value: readyStates.indexOf('CLOSED')\n});\n\n/**\n * @constant {Number} CLOSED\n * @memberof WebSocket.prototype\n */\nObject.defineProperty(WebSocket.prototype, 'CLOSED', {\n  enumerable: true,\n  value: readyStates.indexOf('CLOSED')\n});\n\n[\n  'binaryType',\n  'bufferedAmount',\n  'extensions',\n  'isPaused',\n  'protocol',\n  'readyState',\n  'url'\n].forEach((property) => {\n  Object.defineProperty(WebSocket.prototype, property, { enumerable: true });\n});\n\n//\n// Add the `onopen`, `onerror`, `onclose`, and `onmessage` attributes.\n// See https://html.spec.whatwg.org/multipage/comms.html#the-websocket-interface\n//\n['open', 'error', 'close', 'message'].forEach((method) => {\n  Object.defineProperty(WebSocket.prototype, `on${method}`, {\n    enumerable: true,\n    get() {\n      for (const listener of this.listeners(method)) {\n        if (listener[kForOnEventAttribute]) return listener[kListener];\n      }\n\n      return null;\n    },\n    set(handler) {\n      for (const listener of this.listeners(method)) {\n        if (listener[kForOnEventAttribute]) {\n          this.removeListener(method, listener);\n          break;\n        }\n      }\n\n      if (typeof handler !== 'function') return;\n\n      this.addEventListener(method, handler, {\n        [kForOnEventAttribute]: true\n      });\n    }\n  });\n});\n\nWebSocket.prototype.addEventListener = addEventListener;\nWebSocket.prototype.removeEventListener = removeEventListener;\n\nmodule.exports = WebSocket;\n\n/**\n * Initialize a WebSocket client.\n *\n * @param {WebSocket} websocket The client to initialize\n * @param {(String|URL)} address The URL to which to connect\n * @param {Array} protocols The subprotocols\n * @param {Object} [options] Connection options\n * @param {Boolean} [options.followRedirects=false] Whether or not to follow\n *     redirects\n * @param {Function} [options.generateMask] The function used to generate the\n *     masking key\n * @param {Number} [options.handshakeTimeout] Timeout in milliseconds for the\n *     handshake request\n * @param {Number} [options.maxPayload=104857600] The maximum allowed message\n *     size\n * @param {Number} [options.maxRedirects=10] The maximum number of redirects\n *     allowed\n * @param {String} [options.origin] Value of the `Origin` or\n *     `Sec-WebSocket-Origin` header\n * @param {(Boolean|Object)} [options.perMessageDeflate=true] Enable/disable\n *     permessage-deflate\n * @param {Number} [options.protocolVersion=13] Value of the\n *     `Sec-WebSocket-Version` header\n * @param {Boolean} [options.skipUTF8Validation=false] Specifies whether or\n *     not to skip UTF-8 validation for text and close messages\n * @private\n */\nfunction initAsClient(websocket, address, protocols, options) {\n  const opts = {\n    protocolVersion: protocolVersions[1],\n    maxPayload: 100 * 1024 * 1024,\n    skipUTF8Validation: false,\n    perMessageDeflate: true,\n    followRedirects: false,\n    maxRedirects: 10,\n    ...options,\n    createConnection: undefined,\n    socketPath: undefined,\n    hostname: undefined,\n    protocol: undefined,\n    timeout: undefined,\n    method: undefined,\n    host: undefined,\n    path: undefined,\n    port: undefined\n  };\n\n  if (!protocolVersions.includes(opts.protocolVersion)) {\n    throw new RangeError(\n      `Unsupported protocol version: ${opts.protocolVersion} ` +\n        `(supported versions: ${protocolVersions.join(', ')})`\n    );\n  }\n\n  let parsedUrl;\n\n  if (address instanceof URL) {\n    parsedUrl = address;\n    websocket._url = address.href;\n  } else {\n    try {\n      parsedUrl = new URL(address);\n    } catch (e) {\n      throw new SyntaxError(`Invalid URL: ${address}`);\n    }\n\n    websocket._url = address;\n  }\n\n  const isSecure = parsedUrl.protocol === 'wss:';\n  const isUnixSocket = parsedUrl.protocol === 'ws+unix:';\n  let invalidURLMessage;\n\n  if (parsedUrl.protocol !== 'ws:' && !isSecure && !isUnixSocket) {\n    invalidURLMessage =\n      'The URL\\'s protocol must be one of \"ws:\", \"wss:\", or \"ws+unix:\"';\n  } else if (isUnixSocket && !parsedUrl.pathname) {\n    invalidURLMessage = \"The URL's pathname is empty\";\n  } else if (parsedUrl.hash) {\n    invalidURLMessage = 'The URL contains a fragment identifier';\n  }\n\n  if (invalidURLMessage) {\n    const err = new SyntaxError(invalidURLMessage);\n\n    if (websocket._redirects === 0) {\n      throw err;\n    } else {\n      emitErrorAndClose(websocket, err);\n      return;\n    }\n  }\n\n  const defaultPort = isSecure ? 443 : 80;\n  const key = randomBytes(16).toString('base64');\n  const get = isSecure ? https.get : http.get;\n  const protocolSet = new Set();\n  let perMessageDeflate;\n\n  opts.createConnection = isSecure ? tlsConnect : netConnect;\n  opts.defaultPort = opts.defaultPort || defaultPort;\n  opts.port = parsedUrl.port || defaultPort;\n  opts.host = parsedUrl.hostname.startsWith('[')\n    ? parsedUrl.hostname.slice(1, -1)\n    : parsedUrl.hostname;\n  opts.headers = {\n    'Sec-WebSocket-Version': opts.protocolVersion,\n    'Sec-WebSocket-Key': key,\n    Connection: 'Upgrade',\n    Upgrade: 'websocket',\n    ...opts.headers\n  };\n  opts.path = parsedUrl.pathname + parsedUrl.search;\n  opts.timeout = opts.handshakeTimeout;\n\n  if (opts.perMessageDeflate) {\n    perMessageDeflate = new PerMessageDeflate(\n      opts.perMessageDeflate !== true ? opts.perMessageDeflate : {},\n      false,\n      opts.maxPayload\n    );\n    opts.headers['Sec-WebSocket-Extensions'] = format({\n      [PerMessageDeflate.extensionName]: perMessageDeflate.offer()\n    });\n  }\n  if (protocols.length) {\n    for (const protocol of protocols) {\n      if (\n        typeof protocol !== 'string' ||\n        !subprotocolRegex.test(protocol) ||\n        protocolSet.has(protocol)\n      ) {\n        throw new SyntaxError(\n          'An invalid or duplicated subprotocol was specified'\n        );\n      }\n\n      protocolSet.add(protocol);\n    }\n\n    opts.headers['Sec-WebSocket-Protocol'] = protocols.join(',');\n  }\n  if (opts.origin) {\n    if (opts.protocolVersion < 13) {\n      opts.headers['Sec-WebSocket-Origin'] = opts.origin;\n    } else {\n      opts.headers.Origin = opts.origin;\n    }\n  }\n  if (parsedUrl.username || parsedUrl.password) {\n    opts.auth = `${parsedUrl.username}:${parsedUrl.password}`;\n  }\n\n  if (isUnixSocket) {\n    const parts = opts.path.split(':');\n\n    opts.socketPath = parts[0];\n    opts.path = parts[1];\n  }\n\n  if (opts.followRedirects) {\n    if (websocket._redirects === 0) {\n      websocket._originalHost = parsedUrl.host;\n\n      const headers = options && options.headers;\n\n      //\n      // Shallow copy the user provided options so that headers can be changed\n      // without mutating the original object.\n      //\n      options = { ...options, headers: {} };\n\n      if (headers) {\n        for (const [key, value] of Object.entries(headers)) {\n          options.headers[key.toLowerCase()] = value;\n        }\n      }\n    } else if (parsedUrl.host !== websocket._originalHost) {\n      //\n      // Match curl 7.77.0 behavior and drop the following headers. These\n      // headers are also dropped when following a redirect to a subdomain.\n      //\n      delete opts.headers.authorization;\n      delete opts.headers.cookie;\n      delete opts.headers.host;\n      opts.auth = undefined;\n    }\n\n    //\n    // Match curl 7.77.0 behavior and make the first `Authorization` header win.\n    // If the `Authorization` header is set, then there is nothing to do as it\n    // will take precedence.\n    //\n    if (opts.auth && !options.headers.authorization) {\n      options.headers.authorization =\n        'Basic ' + Buffer.from(opts.auth).toString('base64');\n    }\n  }\n\n  let req = (websocket._req = get(opts));\n\n  if (opts.timeout) {\n    req.on('timeout', () => {\n      abortHandshake(websocket, req, 'Opening handshake has timed out');\n    });\n  }\n\n  req.on('error', (err) => {\n    if (req === null || req.aborted) return;\n\n    req = websocket._req = null;\n    emitErrorAndClose(websocket, err);\n  });\n\n  req.on('response', (res) => {\n    const location = res.headers.location;\n    const statusCode = res.statusCode;\n\n    if (\n      location &&\n      opts.followRedirects &&\n      statusCode >= 300 &&\n      statusCode < 400\n    ) {\n      if (++websocket._redirects > opts.maxRedirects) {\n        abortHandshake(websocket, req, 'Maximum redirects exceeded');\n        return;\n      }\n\n      req.abort();\n\n      let addr;\n\n      try {\n        addr = new URL(location, address);\n      } catch (e) {\n        const err = new SyntaxError(`Invalid URL: ${location}`);\n        emitErrorAndClose(websocket, err);\n        return;\n      }\n\n      initAsClient(websocket, addr, protocols, options);\n    } else if (!websocket.emit('unexpected-response', req, res)) {\n      abortHandshake(\n        websocket,\n        req,\n        `Unexpected server response: ${res.statusCode}`\n      );\n    }\n  });\n\n  req.on('upgrade', (res, socket, head) => {\n    websocket.emit('upgrade', res);\n\n    //\n    // The user may have closed the connection from a listener of the `upgrade`\n    // event.\n    //\n    if (websocket.readyState !== WebSocket.CONNECTING) return;\n\n    req = websocket._req = null;\n\n    const digest = createHash('sha1')\n      .update(key + GUID)\n      .digest('base64');\n\n    if (res.headers['sec-websocket-accept'] !== digest) {\n      abortHandshake(websocket, socket, 'Invalid Sec-WebSocket-Accept header');\n      return;\n    }\n\n    const serverProt = res.headers['sec-websocket-protocol'];\n    let protError;\n\n    if (serverProt !== undefined) {\n      if (!protocolSet.size) {\n        protError = 'Server sent a subprotocol but none was requested';\n      } else if (!protocolSet.has(serverProt)) {\n        protError = 'Server sent an invalid subprotocol';\n      }\n    } else if (protocolSet.size) {\n      protError = 'Server sent no subprotocol';\n    }\n\n    if (protError) {\n      abortHandshake(websocket, socket, protError);\n      return;\n    }\n\n    if (serverProt) websocket._protocol = serverProt;\n\n    const secWebSocketExtensions = res.headers['sec-websocket-extensions'];\n\n    if (secWebSocketExtensions !== undefined) {\n      if (!perMessageDeflate) {\n        const message =\n          'Server sent a Sec-WebSocket-Extensions header but no extension ' +\n          'was requested';\n        abortHandshake(websocket, socket, message);\n        return;\n      }\n\n      let extensions;\n\n      try {\n        extensions = parse(secWebSocketExtensions);\n      } catch (err) {\n        const message = 'Invalid Sec-WebSocket-Extensions header';\n        abortHandshake(websocket, socket, message);\n        return;\n      }\n\n      const extensionNames = Object.keys(extensions);\n\n      if (\n        extensionNames.length !== 1 ||\n        extensionNames[0] !== PerMessageDeflate.extensionName\n      ) {\n        const message = 'Server indicated an extension that was not requested';\n        abortHandshake(websocket, socket, message);\n        return;\n      }\n\n      try {\n        perMessageDeflate.accept(extensions[PerMessageDeflate.extensionName]);\n      } catch (err) {\n        const message = 'Invalid Sec-WebSocket-Extensions header';\n        abortHandshake(websocket, socket, message);\n        return;\n      }\n\n      websocket._extensions[PerMessageDeflate.extensionName] =\n        perMessageDeflate;\n    }\n\n    websocket.setSocket(socket, head, {\n      generateMask: opts.generateMask,\n      maxPayload: opts.maxPayload,\n      skipUTF8Validation: opts.skipUTF8Validation\n    });\n  });\n}\n\n/**\n * Emit the `'error'` and `'close'` event.\n *\n * @param {WebSocket} websocket The WebSocket instance\n * @param {Error} The error to emit\n * @private\n */\nfunction emitErrorAndClose(websocket, err) {\n  websocket._readyState = WebSocket.CLOSING;\n  websocket.emit('error', err);\n  websocket.emitClose();\n}\n\n/**\n * Create a `net.Socket` and initiate a connection.\n *\n * @param {Object} options Connection options\n * @return {net.Socket} The newly created socket used to start the connection\n * @private\n */\nfunction netConnect(options) {\n  options.path = options.socketPath;\n  return net.connect(options);\n}\n\n/**\n * Create a `tls.TLSSocket` and initiate a connection.\n *\n * @param {Object} options Connection options\n * @return {tls.TLSSocket} The newly created socket used to start the connection\n * @private\n */\nfunction tlsConnect(options) {\n  options.path = undefined;\n\n  if (!options.servername && options.servername !== '') {\n    options.servername = net.isIP(options.host) ? '' : options.host;\n  }\n\n  return tls.connect(options);\n}\n\n/**\n * Abort the handshake and emit an error.\n *\n * @param {WebSocket} websocket The WebSocket instance\n * @param {(http.ClientRequest|net.Socket|tls.Socket)} stream The request to\n *     abort or the socket to destroy\n * @param {String} message The error message\n * @private\n */\nfunction abortHandshake(websocket, stream, message) {\n  websocket._readyState = WebSocket.CLOSING;\n\n  const err = new Error(message);\n  Error.captureStackTrace(err, abortHandshake);\n\n  if (stream.setHeader) {\n    stream.abort();\n\n    if (stream.socket && !stream.socket.destroyed) {\n      //\n      // On Node.js >= 14.3.0 `request.abort()` does not destroy the socket if\n      // called after the request completed. See\n      // https://github.com/websockets/ws/issues/1869.\n      //\n      stream.socket.destroy();\n    }\n\n    stream.once('abort', websocket.emitClose.bind(websocket));\n    websocket.emit('error', err);\n  } else {\n    stream.destroy(err);\n    stream.once('error', websocket.emit.bind(websocket, 'error'));\n    stream.once('close', websocket.emitClose.bind(websocket));\n  }\n}\n\n/**\n * Handle cases where the `ping()`, `pong()`, or `send()` methods are called\n * when the `readyState` attribute is `CLOSING` or `CLOSED`.\n *\n * @param {WebSocket} websocket The WebSocket instance\n * @param {*} [data] The data to send\n * @param {Function} [cb] Callback\n * @private\n */\nfunction sendAfterClose(websocket, data, cb) {\n  if (data) {\n    const length = toBuffer(data).length;\n\n    //\n    // The `_bufferedAmount` property is used only when the peer is a client and\n    // the opening handshake fails. Under these circumstances, in fact, the\n    // `setSocket()` method is not called, so the `_socket` and `_sender`\n    // properties are set to `null`.\n    //\n    if (websocket._socket) websocket._sender._bufferedBytes += length;\n    else websocket._bufferedAmount += length;\n  }\n\n  if (cb) {\n    const err = new Error(\n      `WebSocket is not open: readyState ${websocket.readyState} ` +\n        `(${readyStates[websocket.readyState]})`\n    );\n    cb(err);\n  }\n}\n\n/**\n * The listener of the `Receiver` `'conclude'` event.\n *\n * @param {Number} code The status code\n * @param {Buffer} reason The reason for closing\n * @private\n */\nfunction receiverOnConclude(code, reason) {\n  const websocket = this[kWebSocket];\n\n  websocket._closeFrameReceived = true;\n  websocket._closeMessage = reason;\n  websocket._closeCode = code;\n\n  if (websocket._socket[kWebSocket] === undefined) return;\n\n  websocket._socket.removeListener('data', socketOnData);\n  process.nextTick(resume, websocket._socket);\n\n  if (code === 1005) websocket.close();\n  else websocket.close(code, reason);\n}\n\n/**\n * The listener of the `Receiver` `'drain'` event.\n *\n * @private\n */\nfunction receiverOnDrain() {\n  const websocket = this[kWebSocket];\n\n  if (!websocket.isPaused) websocket._socket.resume();\n}\n\n/**\n * The listener of the `Receiver` `'error'` event.\n *\n * @param {(RangeError|Error)} err The emitted error\n * @private\n */\nfunction receiverOnError(err) {\n  const websocket = this[kWebSocket];\n\n  if (websocket._socket[kWebSocket] !== undefined) {\n    websocket._socket.removeListener('data', socketOnData);\n\n    //\n    // On Node.js < 14.0.0 the `'error'` event is emitted synchronously. See\n    // https://github.com/websockets/ws/issues/1940.\n    //\n    process.nextTick(resume, websocket._socket);\n\n    websocket.close(err[kStatusCode]);\n  }\n\n  websocket.emit('error', err);\n}\n\n/**\n * The listener of the `Receiver` `'finish'` event.\n *\n * @private\n */\nfunction receiverOnFinish() {\n  this[kWebSocket].emitClose();\n}\n\n/**\n * The listener of the `Receiver` `'message'` event.\n *\n * @param {Buffer|ArrayBuffer|Buffer[])} data The message\n * @param {Boolean} isBinary Specifies whether the message is binary or not\n * @private\n */\nfunction receiverOnMessage(data, isBinary) {\n  this[kWebSocket].emit('message', data, isBinary);\n}\n\n/**\n * The listener of the `Receiver` `'ping'` event.\n *\n * @param {Buffer} data The data included in the ping frame\n * @private\n */\nfunction receiverOnPing(data) {\n  const websocket = this[kWebSocket];\n\n  websocket.pong(data, !websocket._isServer, NOOP);\n  websocket.emit('ping', data);\n}\n\n/**\n * The listener of the `Receiver` `'pong'` event.\n *\n * @param {Buffer} data The data included in the pong frame\n * @private\n */\nfunction receiverOnPong(data) {\n  this[kWebSocket].emit('pong', data);\n}\n\n/**\n * Resume a readable stream\n *\n * @param {Readable} stream The readable stream\n * @private\n */\nfunction resume(stream) {\n  stream.resume();\n}\n\n/**\n * The listener of the `net.Socket` `'close'` event.\n *\n * @private\n */\nfunction socketOnClose() {\n  const websocket = this[kWebSocket];\n\n  this.removeListener('close', socketOnClose);\n  this.removeListener('data', socketOnData);\n  this.removeListener('end', socketOnEnd);\n\n  websocket._readyState = WebSocket.CLOSING;\n\n  let chunk;\n\n  //\n  // The close frame might not have been received or the `'end'` event emitted,\n  // for example, if the socket was destroyed due to an error. Ensure that the\n  // `receiver` stream is closed after writing any remaining buffered data to\n  // it. If the readable side of the socket is in flowing mode then there is no\n  // buffered data as everything has been already written and `readable.read()`\n  // will return `null`. If instead, the socket is paused, any possible buffered\n  // data will be read as a single chunk.\n  //\n  if (\n    !this._readableState.endEmitted &&\n    !websocket._closeFrameReceived &&\n    !websocket._receiver._writableState.errorEmitted &&\n    (chunk = websocket._socket.read()) !== null\n  ) {\n    websocket._receiver.write(chunk);\n  }\n\n  websocket._receiver.end();\n\n  this[kWebSocket] = undefined;\n\n  clearTimeout(websocket._closeTimer);\n\n  if (\n    websocket._receiver._writableState.finished ||\n    websocket._receiver._writableState.errorEmitted\n  ) {\n    websocket.emitClose();\n  } else {\n    websocket._receiver.on('error', receiverOnFinish);\n    websocket._receiver.on('finish', receiverOnFinish);\n  }\n}\n\n/**\n * The listener of the `net.Socket` `'data'` event.\n *\n * @param {Buffer} chunk A chunk of data\n * @private\n */\nfunction socketOnData(chunk) {\n  if (!this[kWebSocket]._receiver.write(chunk)) {\n    this.pause();\n  }\n}\n\n/**\n * The listener of the `net.Socket` `'end'` event.\n *\n * @private\n */\nfunction socketOnEnd() {\n  const websocket = this[kWebSocket];\n\n  websocket._readyState = WebSocket.CLOSING;\n  websocket._receiver.end();\n  this.end();\n}\n\n/**\n * The listener of the `net.Socket` `'error'` event.\n *\n * @private\n */\nfunction socketOnError() {\n  const websocket = this[kWebSocket];\n\n  this.removeListener('error', socketOnError);\n  this.on('error', NOOP);\n\n  if (websocket) {\n    websocket._readyState = WebSocket.CLOSING;\n    this.destroy();\n  }\n}\n","module.exports = require(\"crypto\");","module.exports = require(\"events\");","module.exports = require(\"fs\");","module.exports = require(\"http\");","module.exports = require(\"https\");","module.exports = require(\"net\");","module.exports = require(\"os\");","module.exports = require(\"path\");","module.exports = require(\"stream\");","module.exports = require(\"tls\");","module.exports = require(\"url\");","module.exports = require(\"zlib\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"process\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"electron\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"child_process\");","import electron from \"electron\"\nimport process from \"process\";\nimport childprocess from \"child_process\";\n\nexport function openLink(url: string): boolean {\n\tlet u = new URL(url)\n\n\tif (u.protocol !== \"http:\" && u.protocol !== \"https:\") {\n\t\treturn false\n\t}\n\tif (!u.hostname) {\n\t\treturn false\n\t}\n\tif (u.port && Number.isNaN(u.port)) {\n\t\treturn false\n\t}\n\n\tlet urlParsed = u.protocol + \"//\" + u.hostname\n\tif (u.port) {\n\t\turlParsed += \":\" + u.port\n\t}\n\tif (u.pathname) {\n\t\turlParsed += u.pathname\n\t}\n\tif (u.search) {\n\t\turlParsed += u.search\n\t}\n\tif (u.hash) {\n\t\turlParsed += u.hash\n\t}\n\n\tif (process.platform === \"linux\") {\n\t\tchildprocess.execFile(\n\t\t\t\"xdg-open\", [urlParsed],\n\t\t\t(err) => {\n\t\t\t\tif (err) {\n\t\t\t\t\telectron.shell.openExternal(urlParsed)\n\t\t\t\t}\n\t\t\t},\n\t\t)\n\t} else {\n\t\telectron.shell.openExternal(urlParsed)\n\t}\n\n\treturn true\n}\n","import createWebSocketStream from './lib/stream.js';\nimport Receiver from './lib/receiver.js';\nimport Sender from './lib/sender.js';\nimport WebSocket from './lib/websocket.js';\nimport WebSocketServer from './lib/websocket-server.js';\n\nexport { createWebSocketStream, Receiver, Sender, WebSocket, WebSocketServer };\nexport default WebSocket;\n","export class BaseError extends Error {\n\tconstructor(name: string, wrapErr: Error, message: string,\n\t\targs?: {[key: string]: any}) {\n\n\t\tsuper()\n\n\t\tif (args) {\n\t\t\tfor (let key in args) {\n\t\t\t\tmessage += \" \" + key + \"=\" + args[key]\n\t\t\t}\n\t\t}\n\n\t\tif (wrapErr) {\n\t\t\tmessage += \"\\n\" + wrapErr\n\t\t}\n\n\t\tthis.name = name\n\t\tthis.message = message\n\t\tif (wrapErr) {\n\t\t\tthis.stack = wrapErr.stack\n\t\t}\n\t}\n}\n\nexport class ReadError extends BaseError {\n\tconstructor(wrapErr: Error, message: string, args?: {[key: string]: any}) {\n\t\tsuper(\"ReadError\", wrapErr, message, args)\n\t}\n}\n\nexport class WriteError extends BaseError {\n\tconstructor(wrapErr: Error, message: string, args?: {[key: string]: any}) {\n\t\tsuper(\"WriteError\", wrapErr, message, args)\n\t}\n}\n\nexport class RequestError extends BaseError {\n\tconstructor(wrapErr: Error, message: string, args?: {[key: string]: any}) {\n\t\tsuper(\"RequestError\", wrapErr, message, args)\n\t}\n}\n","import fs from \"fs\"\nimport path from \"path\"\nimport electron from \"electron\"\nimport * as Errors from \"./Errors\"\n\nfunction push(level: string, msg: string): void {\n\tlet time = new Date()\n\tmsg = \"[\" + time.getFullYear() + \"-\" + (time.getMonth() + 1) + \"-\" +\n\t\ttime.getDate() + \" \" + time.getHours() + \":\" + time.getMinutes() + \":\" +\n\t\ttime.getSeconds() + \"][\" + level  + \"] \" + msg + \"\\n\"\n\n\tconsole.error(msg)\n\n\tlet logPath = path.join(electron.app.getPath(\"userData\"), \"pritunl.log\")\n\n\tfs.appendFile(logPath, msg, (err: Error): void => {\n\t\tif (err) {\n\t\t\terr = new Errors.WriteError(err, \"Logger: Failed to write log\")\n\t\t\tconsole.error(err)\n\t\t}\n\t})\n}\n\nexport function info(msg: string): void {\n\tpush(\"INFO\", msg)\n}\n\nexport function warning(msg: string): void {\n\tpush(\"WARN\", msg)\n}\n\nexport function error(msg: string): void {\n\tpush(\"ERROR\", msg)\n}\n","import http from \"http\"\nimport https from \"https\"\nimport * as Logger from \"./Logger\"\nimport * as Errors from \"./Errors\"\n\nexport var DefaultTimeout = 20\n\nexport class Response {\n\tresponse: http.IncomingMessage\n\theaders: Map<string, string>\n\tstatus: number\n\tmessage: string\n\tdata: string\n\n\tconstructor(res: http.IncomingMessage) {\n\t\tthis.response = res\n\t\tthis.status = res.statusCode\n\t\tthis.message = res.statusMessage\n\t}\n\n\tget(key: string): string {\n\t\tif (this.headers) {\n\t\t\treturn this.headers.get(key)\n\t\t}\n\n\t\tlet curKey: string = null\n\t\tlet headers = new Map<string, string>()\n\n\t\tfor (let item of this.response.rawHeaders) {\n\t\t\tif (curKey) {\n\t\t\t\theaders.set(curKey, item)\n\t\t\t\tcurKey = null\n\t\t\t} else {\n\t\t\t\tcurKey = item\n\t\t\t}\n\t\t}\n\n\t\tthis.headers = headers\n\n\t\treturn this.headers.get(key)\n\t}\n\n\tjson(): object {\n\t\treturn JSON.parse(this.data || null)\n\t}\n\n\tjsonPassive(): object {\n\t\ttry {\n\t\t\treturn JSON.parse(this.data || null)\n\t\t} catch {\n\t\t\treturn null\n\t\t}\n\t}\n\n\tstring(): string {\n\t\treturn this.data\n\t}\n}\n\nexport class Request {\n\tssl: boolean\n\thostname: string\n\tport: number\n\tsocketPath: string\n\tttl: number\n\tmethod: string\n\tpath: string\n\theaders: Map<string, string>\n\tdata: string\n\n\tconstructor() {\n\t\tthis.headers = new Map<string, string>()\n\t}\n\n\ttcp(host: string): Request {\n\t\tlet hosts = host.split(\"://\")\n\n\t\tthis.ssl = hosts[0] === \"https\"\n\n\t\thosts = hosts[1].split(\":\")\n\n\t\tif (hosts.length > 1) {\n\t\t\tthis.port = parseInt(hosts.pop(), 10)\n\t\t} else {\n\t\t\tthis.port = 80\n\t\t}\n\n\t\tthis.hostname = hosts.join(\":\")\n\n\t\treturn this\n\t}\n\n\tunix(path: string): Request {\n\t\tthis.socketPath = path\n\t\treturn this\n\t}\n\n\ttimeout(timeout: number) {\n\t\tthis.ttl = timeout * 1000\n\t}\n\n\tget(path: string): Request {\n\t\tthis.method = \"GET\"\n\t\tthis.path = path\n\t\treturn this\n\t}\n\n\tput(path: string): Request {\n\t\tthis.method = \"PUT\"\n\t\tthis.path = path\n\t\treturn this\n\t}\n\n\tpost(path: string): Request {\n\t\tthis.method = \"POST\"\n\t\tthis.path = path\n\t\treturn this\n\t}\n\n\tdelete(path: string): Request {\n\t\tthis.method = \"DELETE\"\n\t\tthis.path = path\n\t\treturn this\n\t}\n\n\tset(key: string, value: string): Request {\n\t\tthis.headers.set(key, value)\n\t\treturn this\n\t}\n\n\tsend(data: string|object): Request {\n\t\tif (typeof data === \"string\") {\n\t\t\tthis.data = data\n\t\t} else {\n\t\t\tthis.headers.set(\"Content-Type\", \"application/json\")\n\t\t\tthis.data = JSON.stringify(data)\n\t\t}\n\n\t\treturn this\n\t}\n\n\tend(): Promise<Response> {\n\t\treturn new Promise<Response>((resolve, reject): void => {\n\t\t\ttry {\n\t\t\t\tlet options: http.RequestOptions = {\n\t\t\t\t\tpath: this.path,\n\t\t\t\t\tmethod: this.method,\n\t\t\t\t\theaders: Object.fromEntries(this.headers)\n\t\t\t\t}\n\n\t\t\t\tif (this.socketPath) {\n\t\t\t\t\toptions.socketPath = this.socketPath\n\t\t\t\t} else {\n\t\t\t\t\toptions.hostname = this.hostname\n\t\t\t\t\toptions.port = this.port\n\t\t\t\t}\n\n\t\t\t\toptions.timeout = this.ttl || (DefaultTimeout * 1000)\n\n\t\t\t\tlet callback = (nodeResp: http.IncomingMessage) => {\n\t\t\t\t\tlet resp = new Response(nodeResp)\n\n\t\t\t\t\tnodeResp.on(\"data\", (data) => {\n\t\t\t\t\t\tif (data) {\n\t\t\t\t\t\t\tresp.data = data.toString()\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\n\t\t\t\t\tnodeResp.on(\"end\", () => {\n\t\t\t\t\t\tresolve(resp)\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tlet req: http.ClientRequest\n\t\t\t\tif (this.ssl) {\n\t\t\t\t\treq = https.request(options, callback)\n\t\t\t\t} else {\n\t\t\t\t\treq = http.request(options, callback)\n\t\t\t\t}\n\n\t\t\t\treq.on(\"timeout\", () => {\n\t\t\t\t\tlet err = new Errors.RequestError(null, \"Request: Timeout error\")\n\t\t\t\t\treq.destroy(err)\n\t\t\t\t\tLogger.error(err.message)\n\t\t\t\t\treject(err)\n\t\t\t\t})\n\n\t\t\t\treq.on(\"error\", (err) => {\n\t\t\t\t\terr = new Errors.RequestError(err, \"Request: HTTP error\")\n\t\t\t\t\tLogger.error(err.message)\n\t\t\t\t\treject(err)\n\t\t\t\t})\n\n\t\t\t\tif (this.data) {\n\t\t\t\t\treq.write(this.data)\n\t\t\t\t}\n\n\t\t\t\treq.end()\n\t\t\t} catch (err) {\n\t\t\t\terr = new Errors.RequestError(err, \"Request: Exception\")\n\t\t\t\tLogger.error(err.message)\n\t\t\t\treject(err)\n\t\t\t}\n\t\t})\n\t}\n}\n","import WebSocket from \"ws\"\nimport fs from \"fs\"\nimport path from \"path\"\nimport process from \"process\"\nimport * as Request from \"./Request\"\nimport * as Logger from \"./Logger\"\nimport electron from \"electron\";\n\nexport interface Event {\n\tid: string\n\ttype: string\n\tdata?: any\n}\n\nexport type Callback = (event: Event) => void\n\nlet unix = false\nconst unixPath = \"/var/run/pritunl.sock\"\nconst webHost = \"http://127.0.0.1:9770\"\nconst unixWsHost = \"ws+unix://\" + path.join(\n\tpath.sep, \"var\", \"run\", \"pritunl.sock\") + \":\"\nconst webWsHost = \"ws://127.0.0.1:9770\"\n\nlet showConnect = false\nlet socket: WebSocket.WebSocket\nlet callbacks: Callback[] = []\n\nexport let winDrive = 'C:\\\\';\nlet systemDrv = process.env.SYSTEMDRIVE;\nif (systemDrv) {\n\twinDrive = systemDrv + '\\\\';\n}\n\nif (process.platform === \"linux\" || process.platform === \"darwin\") {\n\tunix = true\n}\n\nfunction getAuthPath(): string {\n\tif (process.argv.indexOf(\"--dev\") !== -1) {\n\t\treturn path.join(__dirname, \"..\", \"..\", \"dev\", \"auth\")\n\t} else {\n\t\tif (process.platform === \"win32\") {\n\t\t\treturn path.join(winDrive, \"ProgramData\", \"Pritunl\", \"auth\")\n\t\t} else {\n\t\t\treturn path.join(path.sep, \"var\", \"run\", \"pritunl.auth\")\n\t\t}\n\t}\n}\n\nfunction getAuthToken(): Promise<string> {\n\treturn new Promise<string>((resolve, reject): void => {\n\t\tfs.readFile(getAuthPath(), \"utf-8\", (err, data: string): void => {\n\t\t\tresolve(data ? data.trim() : \"\")\n\t\t})\n\t})\n}\n\nexport function sync(): Promise<boolean> {\n\treturn new Promise<boolean>(async (resolve) => {\n\t\tlet token: string\n\t\ttry {\n\t\t\ttoken = await getAuthToken()\n\t\t} catch(err) {\n\t\t\tLogger.error(err.message || err)\n\t\t\tresolve(false)\n\t\t\treturn\n\t\t}\n\n\t\tlet req = new Request.Request()\n\n\t\tif (unix) {\n\t\t\treq.unix(unixPath)\n\t\t} else {\n\t\t\treq.tcp(webHost)\n\t\t}\n\n\t\treq.get(\"/status\")\n\t\t\t.set(\"Auth-Token\", token)\n\t\t\t.set(\"User-Agent\", \"pritunl\")\n\t\t\t.end()\n\t\t\t.then((resp: Request.Response) => {\n\t\t\t\tif (resp.status === 200) {\n\t\t\t\t\tlet data = resp.jsonPassive() as any\n\t\t\t\t\tif (data) {\n\t\t\t\t\t\tresolve(data.status)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve(false)\n\t\t\t\t\t}\n\t\t\t\t} {\n\t\t\t\t\tresolve(false)\n\t\t\t\t}\n\t\t\t}, (err) => {\n\t\t\t\tLogger.error(err.message)\n\t\t\t\tresolve(false)\n\t\t\t})\n\t})\n}\n\nexport function wakeup(): Promise<boolean> {\n\treturn new Promise<boolean>(async (resolve) => {\n\t\tlet token: string\n\t\ttry {\n\t\t\ttoken = await getAuthToken()\n\t\t} catch(err) {\n\t\t\tLogger.error(err.message || err)\n\t\t\tresolve(false)\n\t\t\treturn\n\t\t}\n\n\t\tlet req = new Request.Request()\n\n\t\tif (unix) {\n\t\t\treq.unix(unixPath)\n\t\t} else {\n\t\t\treq.tcp(webHost)\n\t\t}\n\n\t\treq.post(\"/wakeup\")\n\t\t\t.set(\"Auth-Token\", token)\n\t\t\t.set(\"User-Agent\", \"pritunl\")\n\t\t\t.end()\n\t\t\t.then((resp: Request.Response) => {\n\t\t\t\tif (resp.status === 200) {\n\t\t\t\t\tresolve(true)\n\t\t\t\t} {\n\t\t\t\t\tresolve(false)\n\t\t\t\t}\n\t\t\t}, (err) => {\n\t\t\t\tLogger.error(err.message)\n\t\t\t\tresolve(false)\n\t\t\t})\n\t})\n}\n\nlet authAttempts = 0\nlet connAttempts = 0\nlet dialogShown = false\n\nexport function connect(dev: boolean): Promise<void> {\n\treturn new Promise<void>(async (resolve, reject) => {\n\t\tlet token: string\n\t\ttry {\n\t\t\ttoken = await getAuthToken()\n\t\t} catch(err) {\n\t\t\ttoken = \"\"\n\t\t}\n\n\t\tif (!token) {\n\t\t\tif (authAttempts > 10) {\n\t\t\t\tif (!dialogShown) {\n\t\t\t\t\tdialogShown = true\n\t\t\t\t\telectron.dialog.showMessageBox(null, {\n\t\t\t\t\t\ttype: \"error\",\n\t\t\t\t\t\tbuttons: [\"Retry\", \"Exit\"],\n\t\t\t\t\t\ttitle: \"Pritunl - Service Error (6729\",\n\t\t\t\t\t\tmessage: \"Unable to authenticate communication with \" +\n\t\t\t\t\t\t\t\"background service, try restarting computer\",\n\t\t\t\t\t}).then(function(evt) {\n\t\t\t\t\t\tif (evt.response == 0) {\n\t\t\t\t\t\t\tauthAttempts = 0\n\t\t\t\t\t\t\tconnAttempts = 0\n\t\t\t\t\t\t\tdialogShown = false\n\t\t\t\t\t\t\tconnect(dev)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\telectron.app.quit()\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tauthAttempts += 1\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tconnect(dev)\n\t\t\t\t}, 500)\n\t\t\t}\n\t\t\treturn\n\t\t}\n\n\t\tresolve()\n\n\t\tlet reconnected = false\n\t\tlet wsHost = \"\"\n\t\tlet headers = {\n\t\t\t\"User-Agent\": \"pritunl\",\n\t\t\t\"Auth-Token\": token,\n\t\t} as any\n\n\t\tif (unix) {\n\t\t\twsHost = unixWsHost\n\t\t\theaders[\"Host\"] = \"unix\"\n\t\t} else {\n\t\t\twsHost = webWsHost\n\t\t}\n\n\t\tlet reconnect = (): void => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (reconnected) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\treconnected = true\n\n\t\t\t\tif (connAttempts > 10) {\n\t\t\t\t\tif (!dialogShown) {\n\t\t\t\t\t\tdialogShown = true\n\t\t\t\t\t\telectron.dialog.showMessageBox(null, {\n\t\t\t\t\t\t\ttype: \"error\",\n\t\t\t\t\t\t\tbuttons: [\"Retry\", \"Exit\"],\n\t\t\t\t\t\t\ttitle: \"Pritunl - Service Error (8362)\",\n\t\t\t\t\t\t\tmessage: \"Unable to establish communication with \" +\n\t\t\t\t\t\t\t\t\"background service, try restarting computer\",\n\t\t\t\t\t\t}).then(function (evt) {\n\t\t\t\t\t\t\tif (evt.response == 0) {\n\t\t\t\t\t\t\t\tauthAttempts = 0\n\t\t\t\t\t\t\t\tconnAttempts = 0\n\t\t\t\t\t\t\t\tdialogShown = false\n\t\t\t\t\t\t\t\tconnect(dev)\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\telectron.app.quit()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconnAttempts += 1\n\t\t\t\t}\n\t\t\t\tconnect(dev)\n\t\t\t}, 1000)\n\t\t}\n\n\t\tsocket = new WebSocket(wsHost + \"/events\", {\n\t\t\theaders: headers,\n\t\t})\n\n\t\tsocket.on(\"open\", (): void => {\n\t\t\tconnAttempts = 0\n\t\t\tif (showConnect) {\n\t\t\t\tshowConnect = false\n\t\t\t\tconsole.log(\"Events: Service reconnected\")\n\t\t\t}\n\t\t})\n\n\t\tsocket.on(\"error\", (err: Error) => {\n\t\t\tconsole.error(\"Events: Socket error \" + err)\n\t\t\tshowConnect = true\n\t\t\treconnect()\n\t\t})\n\n\t\tsocket.on(\"onerror\", (err) => {\n\t\t\tconsole.error(\"Events: Socket error \" + err)\n\t\t\tshowConnect = true\n\t\t\treconnect()\n\t\t})\n\n\t\tsocket.on(\"close\", () => {\n\t\t\tshowConnect = true\n\t\t\treconnect()\n\t\t})\n\n\t\tsocket.on(\"message\", (dataBuf: Buffer): void => {\n\t\t\tlet data = JSON.parse(dataBuf.toString())\n\t\t\tfor (let callback of callbacks) {\n\t\t\t\tcallback(data as Event)\n\t\t\t}\n\t\t})\n\t})\n}\n\nexport function send(msg: string) {\n\tif (socket) {\n\t\tsocket.send(msg)\n\t}\n}\n\nexport function subscribe(callback: Callback) {\n\tcallbacks.push(callback)\n}\n","import fs from \"fs\"\nimport path from \"path\"\nimport electron from \"electron\"\nimport * as Errors from \"./Errors\"\nimport * as Logger from \"./Logger\"\n\nclass ConfigData {\n\twindow_width = 0\n\twindow_height = 0\n\tdisable_tray_icon = false\n\tclassic_interface = false\n\tframeless: boolean = null\n\ttheme = \"dark\"\n\n\t_load(data: {[key: string]: any}): void {\n\t\tif (data[\"disable_tray_icon\"] !== undefined) {\n\t\t\tthis.disable_tray_icon = data[\"disable_tray_icon\"]\n\t\t}\n\t\tif (data[\"classic_interface\"] !== undefined) {\n\t\t\tthis.classic_interface = data[\"classic_interface\"]\n\t\t}\n\t\tif (data[\"theme\"] !== undefined) {\n\t\t\tthis.theme = data[\"theme\"]\n\t\t}\n\t\tif (data[\"window_width\"] !== undefined) {\n\t\t\tthis.window_width = data[\"window_width\"]\n\t\t}\n\t\tif (data[\"window_height\"] !== undefined) {\n\t\t\tthis.window_height = data[\"window_height\"]\n\t\t}\n\t\tif (data[\"frameless\"] !== undefined) {\n\t\t\tthis.frameless = data[\"frameless\"]\n\t\t}\n\t}\n\n\tpath(): string {\n\t\treturn path.join(electron.app.getPath(\"userData\"), \"pritunl.json\")\n\t}\n\n\tload(): Promise<void> {\n\t\treturn new Promise<void>((resolve): void => {\n\t\t\tfs.readFile(\n\t\t\t\tthis.path(), \"utf-8\",\n\t\t\t\t(err: NodeJS.ErrnoException, data: string): void => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tif (err.code !== \"ENOENT\") {\n\t\t\t\t\t\t\terr = new Errors.ReadError(err, \"Config: Read error\")\n\t\t\t\t\t\t\tLogger.error(err.message)\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresolve()\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\n\t\t\t\t\tlet configData: any = {}\n\t\t\t\t\tif (data) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconfigData = JSON.parse(data)\n\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\terr = new Errors.ReadError(err, \"Config: Parse error\")\n\t\t\t\t\t\t\tLogger.error(err.message)\n\n\t\t\t\t\t\t\tconfigData = {}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (configData[\"disable_tray_icon\"] !== undefined) {\n\t\t\t\t\t\tthis.disable_tray_icon = configData[\"disable_tray_icon\"]\n\t\t\t\t\t}\n\t\t\t\t\tif (configData[\"classic_interface\"] !== undefined) {\n\t\t\t\t\t\tthis.classic_interface = configData[\"classic_interface\"]\n\t\t\t\t\t}\n\t\t\t\t\tif (configData[\"theme\"] !== undefined) {\n\t\t\t\t\t\tthis.theme = configData[\"theme\"]\n\t\t\t\t\t}\n\t\t\t\t\tif (configData[\"window_width\"] !== undefined) {\n\t\t\t\t\t\tthis.window_width = configData[\"window_width\"]\n\t\t\t\t\t}\n\t\t\t\t\tif (configData[\"window_height\"] !== undefined) {\n\t\t\t\t\t\tthis.window_height = configData[\"window_height\"]\n\t\t\t\t\t}\n\t\t\t\t\tif (configData[\"frameless\"] !== undefined) {\n\t\t\t\t\t\tthis.frameless = configData[\"frameless\"]\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve()\n\t\t\t\t},\n\t\t\t)\n\t\t})\n\t}\n\n\tsave(opts: {[key: string]: any}): Promise<void> {\n\t\tlet data = {\n\t\t\tdisable_tray_icon: opts[\"disable_tray_icon\"],\n\t\t\tclassic_interface: opts[\"classic_interface\"],\n\t\t\twindow_width: opts[\"window_width\"],\n\t\t\twindow_height: opts[\"window_height\"],\n\t\t\tframeless: opts[\"frameless\"],\n\t\t\ttheme: opts[\"theme\"],\n\t\t}\n\n\t\treturn new Promise<void>((resolve, reject): void => {\n\t\t\tthis.load().then((): void => {\n\t\t\t\tif (data.disable_tray_icon === undefined) {\n\t\t\t\t\tdata.disable_tray_icon = this.disable_tray_icon\n\t\t\t\t}\n\t\t\t\tif (data.classic_interface === undefined) {\n\t\t\t\t\tdata.classic_interface = this.classic_interface\n\t\t\t\t}\n\t\t\t\tif (data.window_width === undefined) {\n\t\t\t\t\tdata.window_width = this.window_width\n\t\t\t\t}\n\t\t\t\tif (data.theme === undefined) {\n\t\t\t\t\tdata.theme = this.theme\n\t\t\t\t}\n\t\t\t\tif (data.frameless === undefined) {\n\t\t\t\t\tdata.frameless = this.frameless\n\t\t\t\t}\n\n\t\t\t\tthis._load(data)\n\n\t\t\t\tfs.writeFile(\n\t\t\t\t\tthis.path(), JSON.stringify(data),\n\t\t\t\t\t(err: NodeJS.ErrnoException): void => {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\terr = new Errors.ReadError(err, \"Config: Write error\")\n\t\t\t\t\t\t\tLogger.error(err.message)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve()\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t})\n\t\t})\n\t}\n}\n\nconst Config = new ConfigData()\nexport default Config\n","import process from \"process\"\nimport path from \"path\"\nimport fs from \"fs\"\nimport childprocess from \"child_process\"\nimport electron from \"electron\"\nimport * as Utils from \"./Utils\";\nimport * as Service from \"./Service\"\nimport Config from \"./Config\"\n\nlet tray: electron.Tray\nlet awaken: boolean\nlet ready: boolean\nlet readyError: string\nlet main: Main\nlet windowSize: number[];\n\nif (electron.app.dock) {\n\telectron.app.dock.hide()\n}\n\nprocess.on(\"uncaughtException\", function (error) {\n\tlet errorMsg: string\n\tif (error && error.stack) {\n\t\terrorMsg = error.stack\n\t} else {\n\t\terrorMsg = String(error)\n\t}\n\n\tif (!ready) {\n\t\treadyError = errorMsg\n\t\treturn\n\t}\n\n\telectron.dialog.showMessageBox(null, {\n\t\ttype: \"error\",\n\t\tbuttons: [\"Exit\"],\n\t\ttitle: \"Pritunl Client - Process Error\",\n\t\tmessage: \"Error occured in main process:\\n\\n\" + errorMsg,\n\t}).then(function() {\n\t\telectron.app.quit()\n\t})\n})\n\nprocess.on(\"unhandledRejection\", function (error) {\n\tlet errorMsg: string = String(error)\n\n\tif (!ready) {\n\t\treadyError = errorMsg\n\t\treturn\n\t}\n\n\telectron.dialog.showMessageBox(null, {\n\t\ttype: \"error\",\n\t\tbuttons: [\"Exit\"],\n\t\ttitle: \"Pritunl Client - Process Error\",\n\t\tmessage: \"Error occured in main process:\\n\\n\" + errorMsg,\n\t}).then(function() {\n\t\telectron.app.quit()\n\t})\n})\n\nService.wakeup().then((awake: boolean) => {\n\tawaken = awake\n\tif (ready) {\n\t\tinit()\n\t}\n})\n\nclass Main {\n\twindow: electron.BrowserWindow\n\n\tshowWindow(): void {\n\t\tthis.window.show()\n\t}\n\n\tcreateWindow(): void {\n\t\tlet frameless = false\n\t\tlet titleBarStyle: string\n\t\tlet framelessClient = false\n\t\tlet width = 424\n\t\tlet height = 528\n\t\tlet minWidth = 405\n\t\tlet minHeight = 440\n\t\tlet maxWidth = 670\n\t\tlet maxHeight = 800\n\t\tlet classicIface = Config.classic_interface\n\n\t\tif ((process.platform === \"win32\" && !classicIface) ||\n\t\t\t(Config.frameless && !classicIface)) {\n\n\t\t\tframeless = true\n\t\t\tframelessClient = true\n\t\t\twidth = 430\n\t\t\tminWidth = 430\n\n\t\t\tif (process.platform === \"win32\") {\n\t\t\t\tframeless = false\n\t\t\t\ttitleBarStyle = \"hidden\"\n\t\t\t}\n\t\t}\n\n\t\tif (Config.window_width && Config.window_height) {\n\t\t\twidth = Config.window_width\n\t\t\tif (width < minWidth) {\n\t\t\t\twidth = minWidth\n\t\t\t}\n\t\t\theight = Config.window_height\n\t\t\tif (height < minHeight) {\n\t\t\t\theight = minHeight\n\t\t\t}\n\t\t}\n\n\t\tlet zoomFactor = 1\n\t\tif (process.platform === \"darwin\" && classicIface) {\n\t\t\tzoomFactor = 0.8\n\t\t}\n\n\t\tif (zoomFactor !== 1) {\n\t\t\twidth = Math.round(width * zoomFactor)\n\t\t\theight = Math.round(height * zoomFactor)\n\t\t\tminWidth = Math.round(minWidth * zoomFactor)\n\t\t\tminHeight = Math.round(minHeight * zoomFactor)\n\t\t\tmaxWidth = Math.round(maxWidth * zoomFactor)\n\t\t\tmaxHeight = Math.round(maxHeight * zoomFactor)\n\t\t}\n\n\t\tthis.window = new electron.BrowserWindow({\n\t\t\ttitle: \"Pritunl Client\",\n\t\t\ticon: path.join(__dirname, \"..\", \"logo.png\"),\n\t\t\ttitleBarStyle: titleBarStyle as any,\n\t\t\tframe: !frameless,\n\t\t\tautoHideMenuBar: true,\n\t\t\tfullscreen: false,\n\t\t\tshow: false,\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\tminWidth: minWidth,\n\t\t\tminHeight: minHeight,\n\t\t\tmaxWidth: maxWidth,\n\t\t\tmaxHeight: maxHeight,\n\t\t\tbackgroundColor: \"#151719\",\n\t\t\twebPreferences: {\n\t\t\t\tzoomFactor: zoomFactor,\n\t\t\t\tdevTools: true,\n\t\t\t\tnodeIntegration: true,\n\t\t\t\tcontextIsolation: false,\n\t\t\t}\n\t\t})\n\n\t\telectron.ipcMain.on(\n\t\t\t\"control\",\n\t\t\t(evt: electron.IpcMainEvent, msg: string, data: string) => {\n\t\t\t\tif (msg === \"service-auth-error\") {\n\t\t\t\t\telectron.dialog.showMessageBox(null, {\n\t\t\t\t\t\ttype: \"error\",\n\t\t\t\t\t\tbuttons: [\"Exit\"],\n\t\t\t\t\t\ttitle: \"Pritunl - Service Error (4827)\",\n\t\t\t\t\t\tmessage: \"Failed to load service key. Restart \" +\n\t\t\t\t\t\t\t\"computer and verify background service is running\",\n\t\t\t\t\t}).then(function() {\n\t\t\t\t\t\telectron.app.quit()\n\t\t\t\t\t})\n\t\t\t\t} else if (msg === \"service-conn-error\") {\n\t\t\t\t\telectron.dialog.showMessageBox(null, {\n\t\t\t\t\t\ttype: \"error\",\n\t\t\t\t\t\tbuttons: [\"Exit\"],\n\t\t\t\t\t\ttitle: \"Pritunl - Service Error (2754)\",\n\t\t\t\t\t\tmessage: \"Unable to establish communication with \" +\n\t\t\t\t\t\t\t\"background service, try restarting computer\",\n\t\t\t\t\t}).then(function() {\n\t\t\t\t\t\telectron.app.quit()\n\t\t\t\t\t})\n\t\t\t\t} else if (msg === \"dev-tools\") {\n\t\t\t\t\tthis.window.webContents.openDevTools({\n\t\t\t\t\t\t\"mode\": \"undocked\",\n\t\t\t\t\t})\n\t\t\t\t} else if (msg === \"reload\") {\n\t\t\t\t\tthis.window.reload()\n\t\t\t\t} else if (msg === \"minimize\") {\n\t\t\t\t\tthis.window.minimize()\n\t\t\t\t} else if (msg === \"download-update\") {\n\t\t\t\t\tUtils.openLink(\"https://client.pritunl.com/#install\")\n\t\t\t\t} else if (msg === \"open-link\") {\n\t\t\t\t\tUtils.openLink(data)\n\t\t\t\t}\n\t\t\t},\n\t\t)\n\n\t\tthis.window.on(\"close\", (): void => {\n\t\t\ttry {\n\t\t\t\twindowSize = this.window.getSize()\n\t\t\t} catch {}\n\t\t})\n\n\t\tthis.window.on(\"closed\", async (): Promise<void> => {\n\t\t\telectron.ipcMain.removeAllListeners(\"control\")\n\t\t\tmain = null\n\t\t})\n\n\t\tlet shown = false\n\t\tthis.window.on(\"ready-to-show\", (): void => {\n\t\t\tif (shown) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tshown = true\n\t\t\tthis.window.show()\n\n\t\t\tif (process.argv.indexOf(\"--dev-tools\") !== -1) {\n\t\t\t\tthis.window.webContents.openDevTools({\n\t\t\t\t\t\"mode\": \"undocked\",\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t\tsetTimeout((): void => {\n\t\t\tif (shown) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tshown = true\n\t\t\tthis.window.show()\n\n\t\t\tif (process.argv.indexOf(\"--dev-tools\") !== -1) {\n\t\t\t\tthis.window.webContents.openDevTools({\n\t\t\t\t\t\"mode\": \"undocked\",\n\t\t\t\t})\n\t\t\t}\n\t\t}, 800)\n\n\t\tlet indexUrl = \"\"\n\t\tif (classicIface) {\n\t\t\tindexUrl = \"file://\" + path.join(__dirname, \"..\",\n\t\t\t\t\"index_orig.html\")\n\t\t} else {\n\t\t\tindexUrl = \"file://\" + path.join(__dirname, \"..\",\n\t\t\t\t\"index.html\")\n\t\t}\n\t\tindexUrl += \"?dev=\" + (process.argv.indexOf(\"--dev\") !== -1 ?\n\t\t\t\"true\" : \"false\")\n\t\tindexUrl += \"&dataPath=\" + encodeURIComponent(\n\t\t\telectron.app.getPath(\"userData\"))\n\t\tindexUrl += \"&frameless=\" + (framelessClient ? \"true\" : \"false\")\n\n\t\tthis.window.loadURL(indexUrl, {\n\t\t\tuserAgent: \"pritunl\",\n\t\t})\n\n\t\tif (electron.app.dock) {\n\t\t\telectron.app.dock.show()\n\t\t}\n\t}\n\n\trun(): void {\n\t\tif (main) {\n\t\t\tmain.showWindow()\n\t\t\treturn\n\t\t}\n\n\t\tthis.createWindow()\n\t\tmain = this\n\t}\n}\n\nfunction initTray() {\n\ttray = new electron.Tray(getTrayIcon(false))\n\n\ttray.on(\"click\", function() {\n\t\tlet main = new Main()\n\t\tmain.run()\n\t})\n\ttray.on(\"double-click\", function() {\n\t\tlet main = new Main()\n\t\tmain.run()\n\t})\n\n\tlet trayMenu = electron.Menu.buildFromTemplate([\n\t\t{\n\t\t\tlabel: \"Open Pritunl Client\",\n\t\t\tclick: function () {\n\t\t\t\tlet main = new Main()\n\t\t\t\tmain.run()\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tlabel: \"Exit\",\n\t\t\tclick: function() {\n\t\t\t\telectron.app.quit()\n\t\t\t}\n\t\t}\n\t])\n\n\ttray.setToolTip(\"Pritunl Client\")\n\ttray.setContextMenu(trayMenu)\n\n\tService.sync().then((status: boolean): void => {\n\t\ttray.setImage(getTrayIcon(status))\n\t})\n}\n\nfunction initAppMenu() {\n\tlet appMenu = electron.Menu.buildFromTemplate([\n\t\t{\n\t\t\tlabel: \"Pritunl\",\n\t\t\tsubmenu: [\n\t\t\t\t{\n\t\t\t\t\tlabel: \"Pritunl Client\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: \"Close\",\n\t\t\t\t\taccelerator: \"CmdOrCtrl+Q\",\n\t\t\t\t\trole: \"close\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: \"Exit\",\n\t\t\t\t\tclick: function() {\n\t\t\t\t\t\telectron.app.quit()\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tlabel: \"Edit\",\n\t\t\tsubmenu: [\n\t\t\t\t{\n\t\t\t\t\tlabel: \"Undo\",\n\t\t\t\t\taccelerator: \"CmdOrCtrl+Z\",\n\t\t\t\t\trole: \"undo\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: \"Redo\",\n\t\t\t\t\taccelerator: \"Shift+CmdOrCtrl+Z\",\n\t\t\t\t\trole: \"redo\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: \"separator\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: \"Cut\",\n\t\t\t\t\taccelerator: \"CmdOrCtrl+X\",\n\t\t\t\t\trole: \"cut\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: \"Copy\",\n\t\t\t\t\taccelerator: \"CmdOrCtrl+C\",\n\t\t\t\t\trole: \"copy\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: \"Paste\",\n\t\t\t\t\taccelerator: \"CmdOrCtrl+V\",\n\t\t\t\t\trole: \"paste\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: \"Select All\",\n\t\t\t\t\taccelerator: \"CmdOrCtrl+A\",\n\t\t\t\t\trole: \"selectall\",\n\t\t\t\t},\n\t\t\t],\n\t\t}\n\t] as any)\n\telectron.Menu.setApplicationMenu(appMenu)\n}\n\nfunction init() {\n\tif (awaken === undefined) {\n\t\treturn\n\t} else if (awaken) {\n\t\telectron.app.quit()\n\t\treturn\n\t}\n\n\tConfig.load().then(() => {\n\t\tService.connect(process.argv.indexOf(\"--dev\") !== -1).then(() => {\n\t\t\tif (process.argv.indexOf(\"--no-main\") !== -1) {\n\t\t\t\tif (Config.disable_tray_icon) {\n\t\t\t\t\telectron.app.quit()\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet main = new Main()\n\t\t\t\tmain.run()\n\t\t\t}\n\n\t\t\tinitAppMenu()\n\n\t\t\tif (!Config.disable_tray_icon) {\n\t\t\t\tinitTray()\n\t\t\t}\n\n\t\t\tService.subscribe((event: Service.Event): void => {\n\t\t\t\tif (event.type === \"connected\") {\n\t\t\t\t\tif (tray) {\n\t\t\t\t\t\ttray.setImage(getTrayIcon(true))\n\t\t\t\t\t}\n\t\t\t\t} else if (event.type === \"disconnected\") {\n\t\t\t\t\tif (tray) {\n\t\t\t\t\t\ttray.setImage(getTrayIcon(false))\n\t\t\t\t\t}\n\t\t\t\t} else if (event.type === \"wakeup\") {\n\t\t\t\t\tService.send(\"awake\")\n\n\t\t\t\t\tlet main = new Main()\n\t\t\t\t\tmain.run()\n\t\t\t\t}\n\t\t\t})\n\t\t})\n\t})\n}\n\nfunction getTrayIcon(state: boolean): string {\n\tlet connTray = \"\"\n\tlet disconnTray = \"\"\n\n\tif (process.platform === \"darwin\") {\n\t\tconnTray = path.join(__dirname, \"..\", \"img\",\n\t\t\t\"tray_connected_osxTemplate.png\")\n\t\tdisconnTray = path.join(__dirname, \"..\", \"img\",\n\t\t\t\"tray_disconnected_osxTemplate.png\")\n\t} else if (process.platform === \"win32\") {\n\t\tconnTray = path.join(__dirname, \"..\", \"img\",\n\t\t\t\"tray_connected_win.png\")\n\t\tdisconnTray = path.join(__dirname, \"..\", \"img\",\n\t\t\t\"tray_disconnected_win.png\")\n\t} else if (process.platform === \"linux\") {\n\t\tconnTray = path.join(__dirname, \"..\", \"img\",\n\t\t\t\"tray_connected_linux_light.png\")\n\t\tdisconnTray = path.join(__dirname, \"..\", \"img\",\n\t\t\t\"tray_disconnected_linux_light.png\")\n\t} else {\n\t\tconnTray = path.join(__dirname, \"..\", \"img\",\n\t\t\t\"tray_connected.png\")\n\t\tdisconnTray = path.join(__dirname, \"..\", \"img\",\n\t\t\t\"tray_disconnected.png\")\n\t}\n\n\tif (state) {\n\t\treturn connTray\n\t} else {\n\t\treturn disconnTray\n\t}\n}\n\nelectron.app.on(\"window-all-closed\", (): void => {\n\ttry {\n\t\tConfig.load().then(async (): Promise<void> => {\n\t\t\tif (windowSize && windowSize.length == 2) {\n\t\t\t\tConfig.window_width = windowSize[0]\n\t\t\t\tConfig.window_height = windowSize[1]\n\t\t\t\tawait Config.save({\n\t\t\t\t\twindow_width: Config.window_width,\n\t\t\t\t\twindow_height: Config.window_height,\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tif (Config.disable_tray_icon || !tray) {\n\t\t\t\telectron.app.quit()\n\t\t\t} else {\n\t\t\t\tif (electron.app.dock) {\n\t\t\t\t\telectron.app.dock.hide()\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t} catch (error) {\n\t\tthrow error\n\t}\n})\n\nelectron.app.on(\"open-file\", (): void => {\n\ttry {\n\t\tlet main = new Main()\n\t\tmain.run()\n\t} catch (error) {\n\t\tthrow error\n\t}\n})\n\nelectron.app.on(\"open-url\", (): void => {\n\ttry {\n\t\tlet main = new Main()\n\t\tmain.run()\n\t} catch (error) {\n\t\tthrow error\n\t}\n})\n\nelectron.app.on(\"activate\", (): void => {\n\ttry {\n\t\tlet main = new Main()\n\t\tmain.run()\n\t} catch (error) {\n\t\tthrow error\n\t}\n})\n\nelectron.app.on(\"quit\", (): void => {\n\ttry {\n\t\telectron.app.quit()\n\t} catch (error) {\n\t\tthrow error\n\t}\n})\n\nelectron.app.on(\"ready\", (): void => {\n\tlet profilesPth = path.join(electron.app.getPath(\"userData\"), \"profiles\")\n\t\tfs.exists(profilesPth, function(exists) {\n\t\tif (!exists) {\n\t\t\tfs.mkdir(profilesPth, function() {})\n\t\t}\n\t})\n\n\ttry {\n\t\tif (readyError) {\n\t\t\telectron.dialog.showMessageBox(null, {\n\t\t\t\ttype: \"error\",\n\t\t\t\tbuttons: [\"Exit\"],\n\t\t\t\ttitle: \"Pritunl Client - Process Error\",\n\t\t\t\tmessage: \"Error occured in main process:\\n\\n\" + readyError,\n\t\t\t}).then(function() {\n\t\t\t\telectron.app.quit()\n\t\t\t})\n\t\t\treturn\n\t\t}\n\n\t\tready = true\n\t\tinit()\n\t} catch (error) {\n\t\tthrow error\n\t}\n})\n"],"names":["module","exports","mask","source","output","offset","length","i","unmask","buffer","__dirname","e","fs","path","os","runtimeRequire","vars","process","config","variables","prebuildsOnly","PREBUILDS_ONLY","abi","versions","modules","runtime","electron","ELECTRON_RUN_AS_NODE","window","type","arch","platform","libc","LIBC","existsSync","isAlpine","armv","ARM_VERSION","arm_version","uv","split","load","dir","readdirSync","err","getFirst","filter","files","join","matchBuild","name","test","parseTuple","arr","architectures","every","Boolean","matchTuple","tuple","includes","compareTuples","a","b","parseTags","file","tags","specificity","pop","tag","napi","slice","matchTags","runtimeAgnostic","compareTags","resolve","toUpperCase","replace","release","debug","prebuild","nearby","dirname","execPath","target","node","Error","map","sort","prebuilds","winner","buf","len","EMPTY_BUFFER","concat","list","totalLength","Buffer","allocUnsafe","set","_mask","_unmask","toArrayBuffer","byteLength","byteOffset","toBuffer","data","readOnly","isBuffer","ArrayBuffer","from","isView","bufferUtil","BINARY_TYPES","alloc","GUID","kForOnEventAttribute","Symbol","kListener","kStatusCode","kWebSocket","NOOP","kCode","kData","kError","kMessage","kReason","kTarget","kType","kWasClean","Event","constructor","this","Object","defineProperty","prototype","enumerable","CloseEvent","options","super","undefined","code","reason","wasClean","ErrorEvent","error","message","MessageEvent","EventTarget","addEventListener","listener","wrapper","isBinary","event","toString","call","_closeFrameReceived","_closeFrameSent","once","on","removeEventListener","handler","listeners","removeListener","tokenChars","push","dest","elem","format","extensions","keys","extension","configurations","Array","isArray","params","k","values","v","parse","header","offers","create","extensionName","paramName","mustUnescape","isEscaping","inQuotes","start","end","charCodeAt","SyntaxError","value","token","kDone","kRun","concurrency","pending","Infinity","jobs","add","job","shift","zlib","Limiter","TRAILER","kPerMessageDeflate","kTotalLength","kCallback","kBuffers","zlibLimiter","deflateOnData","chunk","inflateOnData","_maxPayload","RangeError","reset","inflateOnError","_inflate","isServer","maxPayload","_options","_threshold","threshold","_isServer","_deflate","concurrencyLimit","offer","serverNoContextTakeover","server_no_context_takeover","clientNoContextTakeover","client_no_context_takeover","serverMaxWindowBits","server_max_window_bits","clientMaxWindowBits","client_max_window_bits","accept","normalizeParams","acceptAsServer","acceptAsClient","cleanup","close","callback","opts","accepted","find","response","forEach","key","num","Number","isInteger","TypeError","decompress","fin","done","_decompress","result","compress","_compress","endpoint","windowBits","Z_DEFAULT_WINDOWBITS","createInflateRaw","zlibInflateOptions","write","flush","_readableState","endEmitted","createDeflateRaw","zlibDeflateOptions","Z_SYNC_FLUSH","Writable","PerMessageDeflate","isValidStatusCode","isValidUTF8","ErrorCtor","prefix","statusCode","errorCode","captureStackTrace","_binaryType","binaryType","_extensions","_skipUTF8Validation","skipUTF8Validation","_bufferedBytes","_buffers","_compressed","_payloadLength","_fragmented","_masked","_fin","_opcode","_totalPayloadLength","_messageLength","_fragments","_state","_loop","_write","encoding","cb","startLoop","consume","n","dst","Uint8Array","getInfo","getPayloadLength16","getPayloadLength64","getMask","getData","compressed","haveLength","readUInt16BE","readUInt32BE","Math","pow","controlMessage","dataMessage","er","messageLength","fragments","emit","randomFillSync","applyMask","kByteLength","maskBuffer","Sender","socket","generateMask","_generateMask","_maskBuffer","_socket","_firstFragment","_deflating","_queue","static","dataLength","merge","skipMasking","payloadLength","opcode","rsv1","writeUInt16BE","writeUIntBE","enqueue","dispatch","sendFrame","frame","ping","pong","send","perMessageDeflate","binary","_","destroyed","dequeue","Reflect","apply","cork","uncork","Duplex","emitClose","stream","duplexOnEnd","_writableState","finished","destroy","duplexOnError","listenerCount","ws","terminateOnDestroy","duplex","autoDestroy","objectMode","writableObjectMode","msg","pause","_destroy","readyState","CLOSED","nextTick","called","terminate","_final","CONNECTING","_read","isPaused","resume","protocols","Set","protocol","has","_isValidUTF8","EventEmitter","http","createHash","subprotocol","WebSocket","keyRegex","server","socketOnError","abortHandshake","headers","writable","STATUS_CODES","Connection","h","handleProtocols","clientTracking","verifyClient","noServer","backlog","host","port","_server","createServer","req","res","body","writeHead","listen","emitConnection","bind","_removeListeners","addListeners","listening","upgrade","head","handleUpgrade","clients","_shouldEmitClose","address","size","shouldHandle","index","url","indexOf","version","method","toLowerCase","secWebSocketProtocol","secWebSocketExtensions","info","origin","secure","authorized","encrypted","verified","completeUpgrade","readable","update","digest","next","_protocol","setSocket","delete","https","net","tls","randomBytes","Readable","URL","Receiver","readyStates","subprotocolRegex","protocolVersions","_closeCode","_closeMessage","_closeTimer","_paused","_readyState","_receiver","_sender","_bufferedAmount","_redirects","initAsClient","bufferedAmount","onclose","onerror","onopen","onmessage","_url","receiver","receiverOnConclude","receiverOnDrain","receiverOnError","receiverOnMessage","receiverOnPing","receiverOnPong","setTimeout","setNoDelay","unshift","socketOnClose","socketOnData","socketOnEnd","OPEN","removeAllListeners","_req","CLOSING","errorEmitted","sendAfterClose","needDrain","websocket","protocolVersion","followRedirects","maxRedirects","createConnection","socketPath","hostname","timeout","parsedUrl","href","isSecure","isUnixSocket","invalidURLMessage","pathname","hash","emitErrorAndClose","defaultPort","get","protocolSet","tlsConnect","netConnect","startsWith","Upgrade","search","handshakeTimeout","Origin","username","password","auth","parts","_originalHost","entries","authorization","cookie","aborted","location","addr","abort","serverProt","protError","extensionNames","connect","servername","isIP","setHeader","receiverOnFinish","read","clearTimeout","property","require","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","getter","__esModule","d","definition","o","obj","prop","hasOwnProperty","openLink","u","isNaN","urlParsed","BaseError","wrapErr","args","stack","ReadError","WriteError","RequestError","level","time","Date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","console","logPath","Response","status","statusMessage","curKey","Map","item","rawHeaders","json","JSON","jsonPassive","string","Request","tcp","hosts","ssl","parseInt","unix","ttl","put","post","stringify","Promise","reject","fromEntries","nodeResp","resp","unixPath","webHost","unixWsHost","showConnect","callbacks","winDrive","systemDrv","getAuthToken","trim","authAttempts","connAttempts","dialogShown","dev","async","buttons","title","then","evt","reconnected","wsHost","reconnect","log","dataBuf","window_width","window_height","disable_tray_icon","classic_interface","frameless","theme","_load","configData","save","tray","awaken","ready","readyError","main","windowSize","errorMsg","String","awake","init","Main","showWindow","show","createWindow","titleBarStyle","framelessClient","width","height","minWidth","minHeight","maxWidth","maxHeight","classicIface","zoomFactor","round","icon","autoHideMenuBar","fullscreen","backgroundColor","webPreferences","devTools","nodeIntegration","contextIsolation","webContents","openDevTools","reload","minimize","getSize","shown","indexUrl","encodeURIComponent","loadURL","userAgent","run","initTray","getTrayIcon","trayMenu","label","click","setToolTip","setContextMenu","setImage","appMenu","submenu","accelerator","role","initAppMenu","state","connTray","disconnTray","profilesPth","exists"],"sourceRoot":""}